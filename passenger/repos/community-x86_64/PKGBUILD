# $Id$
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>

pkgname=passenger
pkgver=3.0.12
pkgrel=1
_pkgdlnr=76005
pkgdesc="mod_rails passenger"
arch=('i686' 'x86_64')
url="http://www.modrails.com"
license=('GPL')
depends=('ruby' 'ruby-rack' 'curl')
makedepends=('apache')
install=passenger.install
options=('!emptydirs')
source=(http://rubyforge.org/frs/download.php/${_pkgdlnr}/passenger-$pkgver.tar.gz
	passenger-install-apache2-module.patch
	build-fix-git-2012-05-17.diff)
md5sums=('fedcf948a46b76e00ddd25527dac4b6d'
         '3d04eba10c55a955c378678d5df8497f'
         'e2d3409bae3676232f411f03abac440c')

build(){
  cd $srcdir/passenger-$pkgver
#  patch bin/passenger-install-apache2-module <$srcdir/passenger-install-apache2-module.patch
  patch -p1 <$srcdir/build-fix-git-2012-05-17.diff
  ./bin/passenger-install-apache2-module -a
  rake nginx

  mkdir -p $pkgdir/usr/lib/passenger/
  cp -R * $pkgdir/usr/lib/passenger/

  mkdir -p $pkgdir/usr/lib/httpd/modules
  ln -sf /usr/lib/passenger/ext/apache2/mod_passenger.so $pkgdir/usr/lib/httpd/modules/mod_passenger.so
}
