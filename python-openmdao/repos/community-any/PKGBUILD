# Maintainer: Felix Yan <felixonmars@archlinux.org>

pkgname=python-openmdao
pkgver=3.9.1
pkgrel=1
pkgdesc="An open-source high-performance computing platform"
url="https://github.com/OpenMDAO/OpenMDAO"
license=('Apache')
arch=('any')
depends=('python-networkx' 'python-numpy' 'python-pydoe2' 'python-pyparsing' 'python-scipy'
         'python-requests')
optdepends=('python-matplotlib: for docs'
            'python-numpydoc: for docs'
            'python-redbaron: for docs'
            'python-sphinx: for docs'
            'python-tabulate: for docs and notebooks'
            'ipython: for docs and notebooks'
            'python-notebook: for notebooks'
            'python-bokeh: for visualization'
            'python-colorama: for visualization')
checkdepends=('python-mpi4py' 'python-parameterized' 'python-numpydoc' 'python-pycodestyle'
              'python-pydocstyle' 'python-testflo' 'python-websockets' 'python-pyppeteer'
              'python-aiounittest')
source=("https://github.com/OpenMDAO/OpenMDAO/archive/$pkgver/$pkgname-$pkgver.tar.gz")
sha512sums=('c17fa08588e42e1babb3cbaacbcb3954e0b10982f8d8384833a2408f52257f355cfa07e95242b35a2f03e5c174106e5bf387609d62062c9e1dd86af0d73162bf')

prepare() {
  cd OpenMDAO-$pkgver
  sed -e 's/==/>=/' -i setup.py
}

build() {
  cd OpenMDAO-$pkgver
  python setup.py build
}

check() {
  cd OpenMDAO-$pkgver
  PYTHONPATH="$PWD/build/lib" testflo -n 16 --timeout=120 openmdao || echo "Tests failed"
}

package() {
  cd OpenMDAO-$pkgver
  python setup.py install --root="$pkgdir" --optimize=1
}
