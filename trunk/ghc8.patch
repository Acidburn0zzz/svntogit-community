From fe944a96d3e2b8c755970bd28641925617f19613 Mon Sep 17 00:00:00 2001
From: ilovezfs <ilovezfs@icloud.com>
Date: Mon, 23 May 2016 00:53:07 -0700
Subject: [PATCH] git-annex: GHC compatibility

---
 Remote/Bup.hs | 13 +++++++------
 1 file changed, 7 insertions(+), 6 deletions(-)

diff --git a/Remote/Bup.hs b/Remote/Bup.hs
index ac3cc09..a481504 100644
--- a/Remote/Bup.hs
+++ b/Remote/Bup.hs
@@ -133,12 +133,13 @@ store r buprepo = byteStorer $ \k b p -> do
 	showOutput -- make way for bup output
 	let cmd = proc "bup" (toCommand params)
 	quiet <- commandProgressDisabled
-	let runner = if quiet
-			then feedWithQuietOutput
-			else withHandle StdinHandle
-	liftIO $ runner createProcessSuccess cmd $ \h -> do
-		meteredWrite p h b
-		return True
+	if quiet
+		then liftIO $ feedWithQuietOutput createProcessSuccess cmd $ \h -> do
+			meteredWrite p h b
+			return True
+		else liftIO $ withHandle StdinHandle createProcessSuccess cmd $ \h -> do
+			meteredWrite p h b
+			return True
 
 retrieve :: BupRepo -> Retriever
 retrieve buprepo = byteRetriever $ \k sink -> do
