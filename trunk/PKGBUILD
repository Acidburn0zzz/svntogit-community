# $Id$
# Maintainer: Maxime Gauduin <alucryd@archlinux.org>
# Contributor: kirek <rbuldo@gmail.com>
# Contributor: CÃ©dric Bellegarde <gnumdk@gmail.com>

pkgname=lollypop
pkgver=0.9.304
_portal_pkgver=0.9.4
pkgrel=2
pkgdesc='Music player for GNOME'
arch=('any')
url='https://github.com/gnumdk/lollypop'
license=('GPL')
depends=('desktop-file-utils' 'gst-python' 'gtk3' 'python-cairo'
         'python-dbus' 'python-gobject' 'totem-plparser')
makedepends=('gobject-introspection' 'intltool' 'itstool' 'meson' 'python')
optdepends=('easytag: Modify tags'
            'flatpak: Flatpak Portal'
            'gst-libav: FFmpeg plugin for GStreamer'
            'kid3-qt: Store covers in tags'
            'libsecret: Last.FM support'
            'python-pylast: Last.FM support'
            'python-wikipedia: Wikipedia support'
            'youtube-dl: YouTube playback')
_commit='8f3fec20c99498a48f33df00eb64d5af20f81a38'
source=("https://github.com/gnumdk/lollypop/releases/download/${pkgver}/lollypop-${pkgver}.tar.xz"
        "lollypop-portal-${_portal_pkgver}.tar.gz::https://github.com/gnumdk/lollypop-portal/archive/${_portal_pkgver}.tar.gz"
        'lollypop-pylast-2.0.patch::https://github.com/gnumdk/lollypop/commit/15d29a825067b7e854f15c40ec955790877b33f9.patch')
sha256sums=('e80933295f9dbc04ca1b079250cb920678c3aa3b54a11e035d10a0101c371e1c'
            '0afaf691aa1e87e1720960c66bea73a03e7453b2f5e825d4cffdbaaa6406da5c'
            'c3453c1e048d96ba35322d1830c26f03c0723edd97d1d9e26a77ca1afdcd4428')

prepare() {
  cd lollypop-${pkgver}

  patch -Np1 -i ../lollypop-pylast-2.0.patch
}

build() {
  for d in lollypop-portal-${_portal_pkgver} lollypop-${pkgver}; do
    pushd $d
    meson \
      --buildtype='release' \
      --prefix='/usr' \
      --libexecdir='lib/lollypop' \
      build
    ninja -C build
    popd
  done
}

package() {
  for d in lollypop-portal-${_portal_pkgver} lollypop-${pkgver}; do
    DESTDIR="${pkgdir}" ninja -C $d/build install
  done
}

# vim: ts=2 sw=2 et:
