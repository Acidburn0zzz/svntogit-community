# $Id$
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>
# Contributor: William Rea <sillywilly@gmail.com>

pkgname=fbreader
pkgver=0.12.8
pkgrel=1
pkgdesc="An e-book reader for Linux"
arch=('i686' 'x86_64')
url="http://www.fbreader.org/"
license=('GPL')
depends=(fribidi bzip2 curl gtk2)
source=(http://only.mawhrin.net/fbreader/fbreader-sources-$pkgver.tgz
	http://archlinux-stuff.googlecode.com/files/liblinebreak-20080321.tar.gz
	build-fix.patch)
md5sums=('c47d7f22455c02e6cea81d5bda7ef3f7'
         'adec1484446029222dcedcd12f7e635e'
         '66ac17d8640625b6d2a806de4aa4e76c')

build() {
  cd $startdir/src/liblinebreak-20080321
  make CFLAGS=-fPIC || return 1

  export CPPFLAGS="-I/usr/include/cairo"
  export TARGET_ARCH=desktop
  export UI_TYPE=gtk
  export TARGET_STATUS=release

  cd $startdir/src/fbreader-$pkgver

  patch -p0 makefiles/config.mk <$srcdir/build-fix.patch
  sed -i '1,1i#include <stdio.h>' zlibrary/core/src/util/ZLStringUtil.cpp
  export srcdir
  make INSTALLDIR=/usr || return 1
  make INSTALLDIR=/usr DESTDIR=$startdir/pkg install
}
