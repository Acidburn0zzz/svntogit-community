# $Id$
# Maintainer: Lukas Jirkovsky <l.jirkovsky@gmail.com>
pkgname=fatrat
pkgver=1.2.0_beta1gitd620a99
pkgrel=1
pkgdesc="QT4 based download manager with support for HTTP, FTP, SFTP, BitTorrent, rapidshare and more"
arch=('i686' 'x86_64')
url="http://fatrat.dolezel.info/"
license=('GPL')
depends=('gloox' 'qt' 'libtorrent-rasterbar' 'pion-net' 'qtwebkit')
optdepends=('geoip: GeoIP support')
makedepends=('boost' 'cmake' 'java-environment' 'git')
#source=(http://www.dolezel.info/download/data/fatrat/fatrat-$pkgver.tar.gz)
#md5sums=('7ce4d5e6318361f36ba5ac86a5755da9')

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [[ -d "$pkgname" ]]; then
    cd "$pkgname" && git pull origin
    msg "The local files are updated."
  else
    git clone "git://git.dolezel.info/fatrat.git" $pkgname
  fi
  msg "GIT checkout done or server timeout"
  msg "Starting build..."

  cd "$srcdir/$pkgname"
  git checkout d620a997d3a7bc569cf75ccd13891a231d7703ec

  . /etc/profile.d/jre.sh
  . /etc/profile.d/jdk.sh

  cmake \
    -DWITH_EVERYTHING=ON \
    -DCMAKE_{SHARED,MODULE,EXE}_LINKER_FLAGS="-lpthread" \
    -DCMAKE_CXX_FLAGS="${CXXFLAGS} -DBOOST_ASIO_DYN_LINK" \
    -DCMAKE_INSTALL_PREFIX=/usr \
    .

  make
}

package() {
  cd "$srcdir/$pkgname"
  make DESTDIR="$pkgdir" install
}

# vim:set ts=2 sw=2 et:
