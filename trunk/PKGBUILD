# $Id$
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>

pkgname=ecb
pkgver=2.40.1pre
pkgrel=6
pkgdesc="Emacs Code Browser"
arch=('any')
url="http://ecb.sourceforge.net/"
depends=('emacs' 'cedet')
license=('GPL')
install=ecb.install
#source=(http://downloads.sourceforge.net/ecb/$pkgname-$pkgver.tar.gz)
source=(ecb-$pkgver.tar.gz::http://ecb.sourceforge.net/cvs_snapshots/ecb.tar.gz)
md5sums=('cd5f6594773e2abc9bfebac422ccaa79')

build() {
  cd $srcdir/$pkgname-snap
  sed -i "s|1 0 4 9|1 2 0 0|" ecb-cedet-wrapper.el
  patch -p0 ecb.el <<EOF
1219c1219
<     (let ((stack-trace-on-error stack-trace-on-error))
---
>     (let ((debug-on-error debug-on-error))
EOF
}

package() {
  cd $srcdir/$pkgname-snap
  mkdir -p $pkgdir/usr/share/emacs/site-lisp/ecb
  make CEDET=/usr/share/emacs/site-lisp/cedet ecb
  cp -R $srcdir/$pkgname-snap/* $pkgdir/usr/share/emacs/site-lisp/ecb
  find $pkgdir/usr/share -type f -exec chmod 0644 {} \;
  find $pkgdir/usr/share -type d -exec chmod 0755 {} \;
}
