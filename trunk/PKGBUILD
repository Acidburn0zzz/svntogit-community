# $Id$
# Maintainer: Alexander F. RÃ¸dseth <xyproto@archlinux.org>
# Contributor: Florian Pritz <bluewind@xinu.at>
# Contributor: domanov <domanov@gmail.com>

pkgname=ditaa
pkgver=0.11.0
pkgrel=1
pkgdesc='Utility for converting ASCII art diagrams into bitmaps'
arch=('any')
url='https://github.com/stathissideris/ditaa'
license=('GPL')
depends=('gsfonts' 'java-environment>=8')
makedepends=('apache-ant' 'git')
source=("https://github.com/stathissideris/$pkgname/releases/download/v$pkgver/$pkgname-$pkgver-standalone.jar"
        "git+https://github.com/stathissideris/$pkgname#tag=v$pkgver"
        $pkgname.sh)
sha256sums=('9418aa63ff6d89c5d2318396f59836e120e75bea7a5930c4d34aa10fe7a196a9'
            'SKIP'
            '77f95a7c3235a1263b560844f988445083895550385bff1a4c28313b0767e38f')

prepare() {
  local oldver="0_9"
  local shortver=${pkgver%.0}
  local underver=${shortver/./_}
  sed -i "s|$oldver|${shortver/./_}|" $pkgname/build/release.xml
  sed -i 's|1.6|1.8|g' $pkgname/build/release.xml
  sed -i "s|VERSION|$shortver|" $pkgname.sh
  mkdir -p $pkgname/{bin,lib}
  sed -i 's|</javac>|<compilerarg value="-Xlint:unchecked"/></javac>|g' $pkgname/build/release.xml
}

build() {
  cd "$pkgname"

  # TODO: Build with leiningen, after moving it from AUR to [community]
  #ant -buildfile build/release.xml release-jar
}

package() {
  local shortver=${pkgver%.0}
  install -Dm644 "$srcdir/$pkgname-$pkgver-standalone.jar" \
    "$pkgdir/usr/share/java/$pkgname/$pkgname-$shortver.jar"
  #install -Dm644 "$pkgname/releases/$pkgname$shortver.jar" \
  #  "$pkgdir/usr/share/java/$pkgname/$pkgname-$shortver.jar"
  install -Dm755 $pkgname.sh "$pkgdir/usr/bin/$pkgname"
}

# vim: ts=2 sw=2 et:
