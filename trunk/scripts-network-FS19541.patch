--- network.orig	2013-05-06 01:26:27.000000000 +0400
+++ network	2013-05-06 01:31:28.718026417 +0400
@@ -89,7 +89,7 @@
          else
             echo `date` "[rescue_nic] activating $nic ..."
 
-            ifup $nic
+            ip link set $nic up
             exitCode=`expr $exitCode \| $?`
          fi
       done < $activeList
@@ -118,7 +118,7 @@
    # `which' may be a bit noisy, so we'll shush it.
    dbusSend=`which dbus-send 2>/dev/null`
    rc=$?
-   if [ $rc -ne 0 ]; then
+   if [ $rc -ne 0 ] || [ -z `pidof dbus-daemon` ]; then
       return $rc
    fi
 
@@ -191,7 +191,7 @@
    # `which' may be a bit noisy, so we'll shush it.
    dbusSend=`which dbus-send 2>/dev/null`
    rc=$?
-   if [ $rc = 0 ]; then
+   if [ $rc = 0 ] && [ `pidof dbus-daemon` ]; then
       # NetworkManager 0.8.0
       $dbusSend --system --print-reply          \
          --dest=org.freedesktop.NetworkManager  \
@@ -237,7 +237,7 @@
 
    # XXX Are these really necessary?  If so, we should have seen customer
    # complaints by now.
-   which ifup >/dev/null 2>&1      || Panic "ifup not in search path."
+#   which ifup >/dev/null 2>&1     || Panic "ifup not in search path."
    which ifconfig >/dev/null 2>&1  || Panic "ifconfig not in search path."
 
    case "$1" in
