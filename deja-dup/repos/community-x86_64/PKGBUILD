# Maintainer: Balló György <ballogyor+arch at gmail dot com>

pkgname=deja-dup
pkgver=40.5
pkgrel=1
pkgdesc="Simple backup tool, that hides the complexity of backing up the Right Way and uses duplicity as the backend"
arch=('x86_64')
url="https://wiki.gnome.org/Apps/DejaDup"
license=('GPL')
depends=('duplicity' 'gnome-keyring' 'gnome-online-accounts' 'gvfs' 'python2-gobject' 'python2-pydrive')
makedepends=('appstream-glib' 'gobject-introspection' 'intltool' 'itstool' 'meson' 'nautilus' 'vala' git)
optdepends=('nautilus: backup extension')
_commit=7695822a303bbdd9df1fbc495a0a9a291ddc96dd  # tags/40.5
source=("git+https://gitlab.gnome.org/World/deja-dup.git#commit=$_commit")
validpgpkeys=('A3A5C2FC56AE7341D308D8571B50ECA373F3F233') # Michael Terry
sha256sums=('SKIP')

pkgver() {
  cd $pkgname
  git describe --tags | sed 's/-/+/g'
}

prepare() {
  cd $pkgname
  git cherry-pick -n 05422eab47e444525427b4108c64a00721139712
}

build() {
  arch-meson $pkgname build
  ninja -C build
}

package() {
  DESTDIR="$pkgdir" meson install -C build
}
