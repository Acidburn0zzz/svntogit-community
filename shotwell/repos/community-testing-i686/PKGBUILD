# $Id$
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>
# Maintainer : Ionut Biru <ibiru@archlinux.org>
# Contributor: Joeny Ang <ang(dot)joeny(at)gmail(dot)com>

pkgname=shotwell
pkgver=0.11.5
pkgrel=1
pkgdesc="A digital photo organizer designed for the GNOME desktop environment"
arch=('i686' 'x86_64')
url="http://yorba.org/shotwell/"
license=('LGPL2.1')
depends=('gconf' 'libgee' 'libgphoto2' 'libunique' 'libwebkit' 'libgexiv2' 'libraw'
	 'librsvg' 'json-glib' 'desktop-file-utils' 'dconf')
makedepends=('intltool' 'vala')
install=shotwell.install
source=("http://yorba.org/download/shotwell/0.11/shotwell-${pkgver}.tar.bz2"
	"http://ftp.gnome.org/pub/gnome/sources/vala/0.12/vala-0.12.1.tar.bz2"
	"build-hack.patch")
md5sums=('d437c73127b1cb29a8f9c014effc6aa0'
         'bf35262cc611de447147d01cbac33767'
         'afc8657b3fb3803d40f5e621e7857af8')

build() {
  cd "${srcdir}/vala-0.12.1"
  ./configure --prefix=$srcdir/vala --enable-vapigen
  make
  make install
  export PATH=$srcdir/vala/bin:$PATH

  cd "${srcdir}/${pkgname}-${pkgver}"
  ./configure --prefix=/usr \
	--with-gconf-schema-file-dir=/usr/share/gconf/schemas \
	--disable-schemas-install \
	--disable-desktop-update \
	--disable-icon-update
  # hack
  make || true
  patch -p1 <$srcdir/build-hack.patch
  make
}

package() {
  cd "${srcdir}/${pkgname}-${pkgver}"
  make DESTDIR="${pkgdir}" install
  rm -f $pkgdir/usr/share/glib-2.0/schemas/gschemas.compiled
}
