# Maintainer: Felix Yan <felixonmars@archlinux.org>

pkgname=golang-deepin-lib
pkgver=1.9.0
_commit=22913e13bc9a61441e087df2642b297207190394
pkgrel=1
pkgdesc='A library containing many useful go routines for things such as glib, gettext, archive, graphic,etc.'
arch=('any')
url="https://github.com/linuxdeepin/go-lib"
license=('GPL3')
depends=('go-pie' 'libpulse' 'gdk-pixbuf2' 'mobile-broadband-provider-info' 'libx11')
replaces=('deepin-go-lib')
conflicts=('deepin-go-lib')
provides=('deepin-go-lib')
source=("$pkgname-$_commit.tar.gz::https://github.com/linuxdeepin/go-lib/archive/$_commit.tar.gz")
sha512sums=('78453f036bd1e5654ca6fa6b1622943469bc2f238c800531d5c103b992a95887a8feaba74f6a770810ac93470bc848e09a7851fd532eb00448cebf0f6a38f829')

check() {
  export GOPATH="$srcdir/build:/usr/share/gocode"
  mkdir -p "$srcdir"/build/src/pkg.deepin.io
  cp -a "$srcdir"/go-lib-$_commit "$srcdir"/build/src/pkg.deepin.io/lib
  cd "$srcdir"/build/src/pkg.deepin.io/lib
  # TODO
  # go test -v $(go list ./... | grep -v vendor)
}

package() {
  mkdir -p "$pkgdir"/usr/share/gocode/src/pkg.deepin.io
  cp -a "$srcdir"/go-lib-$_commit "$pkgdir"/usr/share/gocode/src/pkg.deepin.io/lib

  rm -r "$pkgdir"/usr/share/gocode/src/pkg.deepin.io/lib/debian
}
