# Maintainer: Konstantin Gizdov <arch at kge dot pw>
# Contributor: Jerome Leclanche <jerome@leclan.ch>

pkgbase=cascadia-code
pkgname=("ttf-${pkgbase}" "otf-${pkgbase}" "woff2-${pkgbase}")
pkgver=2102.03
pkgrel=1
pkgdesc="A monospaced font by Microsoft that includes programming ligatures"
arch=("any")
url="https://github.com/microsoft/cascadia-code"
license=("custom:OFL")
source=(
    "${pkgname}-${pkgver}-release.zip::https://github.com/microsoft/${pkgbase}/releases/download/v${pkgver}/CascadiaCode-${pkgver}.zip"
    "${pkgname}-${pkgver}.tar.gz::https://github.com/microsoft/${pkgbase}/archive/v${pkgver}.tar.gz"
)
sha256sums=('6c96e5ffab9dbe0802a232bf5cb3c8538ee22a10e70c7897a3b3924a4b1b2e36'
            '97f3b7ca3d174721e8b53f9724d551f9c2dec8541edeb5e043fbc176d2e774bc')

function prepare() {
    cd "${srcdir}/otf/static"
    cp ./*.otf ../
}

function _package() {
    cd "${srcdir}/"

    local ext="${1%%-*}"
    local installdir="${ext^^}"
    local fonts=("${srcdir}/${ext}"/*."${ext}")

    # Install fonts
    install -d "${pkgdir}/usr/share/fonts/${installdir}"
    local font
    for font in "${fonts[@]}"; do
        install -m644 "${font}" "${pkgdir}/usr/share/fonts/${installdir}"
    done

    # Install license
    install -Dm644 "${srcdir}/${pkgbase}-${pkgver}/LICENSE" "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
}

for _pkgname in ${pkgname[@]}; do
    eval "function package_$_pkgname() { _package $_pkgname; }"
done
