# Maintainer: Felix Yan <felixonmars@archlinux.org>

pkgname=v2ray-geoip
pkgver=20190813
pkgrel=1
pkgdesc="GeoIP List for V2Ray"
arch=('any')
url="https://github.com/v2ray/geoip"
license=('MIT')
makedepends=('go-pie' 'git')
source=("GeoLite2-Country-CSV-$pkgver.zip::https://geolite.maxmind.com/download/geoip/database/GeoLite2-Country-CSV.zip")
sha512sums=('fbf72cf86a5da8972188304b4b51e3dc9947a776914faa7c640d49cb2985d7755d12f9bba70857a9430d743ab45638cd1373e295e678095db5796f42177f6db5')

prepare() {
  mkdir .gopath
  export GOPATH="$srcdir/.gopath"

  go get github.com/v2ray/geoip

  mv "$srcdir"/GeoLite2-Country-CSV_$pkgver .gopath/geoip
}

build() {
  cd .gopath
  bin/geoip --country=./geoip/GeoLite2-Country-Locations-en.csv --ipv4=./geoip/GeoLite2-Country-Blocks-IPv4.csv --ipv6=./geoip/GeoLite2-Country-Blocks-IPv6.csv
}

package() {
  cd .gopath
  install -Dm755 geoip.dat "$pkgdir"/etc/v2ray/geoip.dat
  install -Dm644 "$GOPATH"/src/github.com/v2ray/geoip/LICENSE "$pkgdir"/usr/share/licenses/$pkgname/LICENSE
}
