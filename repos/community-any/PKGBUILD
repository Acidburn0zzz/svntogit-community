# Maintainer: Felix Yan <felixonmars@archlinux.org>

pkgname=v2ray-geoip
pkgver=20191022
pkgrel=1
pkgdesc="GeoIP List for V2Ray"
arch=('any')
url="https://github.com/v2ray/geoip"
license=('MIT')
makedepends=('go-pie' 'git')
source=("GeoLite2-Country-CSV-$pkgver.zip::https://geolite.maxmind.com/download/geoip/database/GeoLite2-Country-CSV.zip")
sha512sums=('6c929c7309c6c027e922844a60fd91d1e36e75a9c11e1f198fce8ca12c139f75abbc1d32513510f248f17e44a7e58fe75ca37a05d354d7e270195b8654864482')

prepare() {
  mkdir .gopath
  export GOPATH="$srcdir/.gopath"

  go get -insecure github.com/v2ray/geoip

  mv "$srcdir"/GeoLite2-Country-CSV_$pkgver .gopath/geoip
}

build() {
  cd .gopath
  bin/geoip --country=./geoip/GeoLite2-Country-Locations-en.csv --ipv4=./geoip/GeoLite2-Country-Blocks-IPv4.csv --ipv6=./geoip/GeoLite2-Country-Blocks-IPv6.csv
}

package() {
  cd .gopath
  install -Dm755 geoip.dat "$pkgdir"/etc/v2ray/geoip.dat
  install -Dm644 "$GOPATH"/src/github.com/v2ray/geoip/LICENSE "$pkgdir"/usr/share/licenses/$pkgname/LICENSE
}
