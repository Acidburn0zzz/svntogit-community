# $Id$
# Maintainer: AndyRTR <andyrtr@archlinux.org>
# Contributor: kiefer <jorgelmadrid@gmail.com>

pkgname=lxdm
pkgver=0.4.1
pkgrel=1
pkgdesc="Lightweight Display Manager (part of LXDE)"
arch=('i686' 'x86_64')
url="http://sourceforge.net/projects/lxdm/"
license=('GPL')
groups=('lxde')
depends=('gtk2' 'xorg-server' 'consolekit')
makedepends=('intltool')
install=${pkgname}.install
backup=('etc/lxdm/lxdm.conf') # 'etc/lxdm/xinitrc')
source=("http://downloads.sourceforge.net/lxde/$pkgname-$pkgver.tar.gz"
        Xsession.patch lxdm.patch lxdm-pam.patch lxdm-daemon)
md5sums=('8da1cfc2be6dc9217c85a7cf51e1e821'
         '9bdf95adb74d81d4b6b6176fb1142090'
         'baed9055e8825a5511712bc095197519'
         'b20fe3c8487a039050986d60e45233a9'
         '705f394052fdd0dec22e95321d170de0')

build() {
  	cd $srcdir/$pkgname-$pkgver
    	./configure --sysconfdir=/etc --prefix=/usr --libexecdir=/usr/lib/lxdm
	make
  	
	patch -Np0 < ../lxdm.patch
	patch -Np0 < ../Xsession.patch
}


package() {
  	cd $srcdir/$pkgname-$pkgver
  	make DESTDIR="${pkgdir}" install

	install -m644 ${srcdir}/lxdm-pam.patch ${pkgdir}/etc/pam.d/lxdm
	install -Dm755 ${srcdir}/lxdm-daemon ${pkgdir}/etc/rc.d/lxdm
	
	# these files are not in the package, but should be owned by lxdm - taken from Fedora pkg
#	touch ${pkgdir}/etc/lxdm/xinitrc
	install -d ${pkgdir}/var/{lib,run}/lxdm
#	touch ${pkgdir}/var/lib/lxdm/lxdm.conf
	
	# fix the greeter location
    # on 0.4.1 this sed have to changed since they changed the default path
	sed -i -e "s/local\/libexec/lib\/lxdm/" ${pkgdir}/etc/lxdm/lxdm.conf
}
