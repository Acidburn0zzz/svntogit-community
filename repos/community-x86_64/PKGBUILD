# $Id: PKGBUILD 57731 2011-11-01 19:02:36Z bpiotrowski $
# Maintainer: Bart≈Çomiej Piotrowski <barthalion@gmail.com>
# Contributor: AndyRTR <andyrtr@archlinux.org>
# Contributor: kiefer <jorgelmadrid@gmail.com>

pkgname=lxdm
pkgver=0.4.1
pkgrel=4
pkgdesc="Lightweight Display Manager (part of LXDE)"
arch=('i686' 'x86_64')
url="http://sourceforge.net/projects/lxdm/"
license=('GPL')
groups=('lxde')
depends=('gtk2' 'xorg-server' 'consolekit')
makedepends=('intltool')
install=${pkgname}.install
backup=('etc/lxdm/lxdm.conf' 'etc/pam.d/lxdm' 'etc/lxdm/Xsession'
        'etc/lxdm/PreLogin' 'etc/lxdm/LoginReady' 'etc/lxdm/PostLogin'
        'etc/lxdm/PostLogout' 'etc/lxdm/PreReboot' 'etc/lxdm/PreShutdown')
source=("http://downloads.sourceforge.net/lxde/$pkgname-$pkgver.tar.gz"
        lxdm.patch lxdm-conf.patch lxdm-pam.patch lxdm-daemon)
md5sums=('8da1cfc2be6dc9217c85a7cf51e1e821'
         'baed9055e8825a5511712bc095197519'
         'c50dd01b715b0a236407d48066191601'
         'b20fe3c8487a039050986d60e45233a9'
         '705f394052fdd0dec22e95321d170de0')

build() {
  	cd $srcdir/$pkgname-$pkgver
    ./configure --sysconfdir=/etc --prefix=/usr --libexecdir=/usr/lib/lxdm
	make
  	
	patch -Np0 < ../lxdm.patch
    patch -Np0 < ../lxdm-conf.patch
}


package() {
  	cd $srcdir/$pkgname-$pkgver
  	make DESTDIR="${pkgdir}" install

	install -m644 ${srcdir}/lxdm-pam.patch ${pkgdir}/etc/pam.d/lxdm
	install -Dm755 ${srcdir}/lxdm-daemon ${pkgdir}/etc/rc.d/lxdm
	
	# these files are not in the package, but should be owned by lxdm - taken from Fedora pkg
    #touch ${pkgdir}/etc/lxdm/xinitrc
	install -d ${pkgdir}/var/{lib,run}/lxdm
    #touch ${pkgdir}/var/lib/lxdm/lxdm.conf
	
	# fix the greeter location
    # on 0.4.1 this sed have to changed since they changed the default path
	sed -i -e "s/local\/libexec/lib\/lxdm/" ${pkgdir}/etc/lxdm/lxdm.conf
}
