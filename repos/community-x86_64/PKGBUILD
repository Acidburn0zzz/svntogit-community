# Maintainer: David Runge <dvzrv@archlinux.org>
# Contributor: muzhed <chustokes@126.com>

pkgname=din
pkgver=43.0.1
pkgrel=1
pkgdesc="A sound synthesizer and musical instrument."
arch=('x86_64')
url="https://dinisnoise.org/"
license=('GPL2')
groups=('pro-audio')
depends=('glibc' 'hicolor-icon-theme' 'jack' 'libgl' 'rtaudio' 'rtmidi' 'sdl' 'tcl')
makedepends=('boost' 'glu')
source=("https://archive.org/download/dinisnoise_source_code/${pkgname}-${pkgver}.tar.gz"
        "din-43-devendor-rtaudio_rtmidi.patch"
)
sha512sums=('14df7f52a80801f062ed1a81c5625d8730e7bcc21cfa5256ecce9b478494828a3d0877c37434f30883aa519f767a70ba1cee4d203ec57c5bc72de1c47d2d848d'
            'eab5e6bc55a81ede0b415706f9a6805d0a78a2d5dc58c2bb23ca3a3c0a7de6ddd3f2c4c99771a3068907864f5898c135d32d0de6d85b10933824b9f22d1e329e')

prepare() {
  cd "${pkgname}-${pkgver}"
  # use system rtaudio/rtmidi, instead of vendored versions
  patch -Np1 -i ../din-43-devendor-rtaudio_rtmidi.patch
  autoreconf -vfi
}

build() {
  cd "${pkgname}-${pkgver}"
  export CXXFLAGS="${CXXFLAGS} $(pkg-config --cflags jack rtaudio rtmidi)"
  export CFLAGS="${CFLAGS} $(pkg-config --cflags jack rtaudio rtmidi)"
  export LIBS="${LIBS} $(pkg-config --libs jack rtaudio rtmidi)"
  ./configure --prefix='/usr'
  make
}

package() {
  cd "${pkgname}-${pkgver}"
  make install DESTDIR="${pkgdir}"
  # docs
  install -t "${pkgdir}/usr/share/doc/${pkgname}/" \
    -vDm 644 {AUTHORS,BUGS,CHANGELOG,NEWS,README,TODO}
}
