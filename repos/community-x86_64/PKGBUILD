# $Id$
# Maintainer: Alexandre Filgueira <alexfilgueira@antergos.com>

pkgbase="nemo-extensions"
pkgname=('nemo-fileroller'
	'nemo-share'
	'nemo-python'
	'nemo-seahorse')
	# 'nemo-media-columns'
	#'nemo-pastebin'
	#'nemo-preview'
	# 'nemo-compare'
	#'nemo-rabbitvcs'
pkgver=2.0.0
pkgrel=1
arch=('i686' 'x86_64')
license=('GPL2')
url="https://github.com/linuxmint/nemo-extensions"
depends=(nemo python2-gobject gconf libgnome-keyring libcryptui file-roller samba pastebinit \
		 clutter-gtk clutter-gst gst-plugins-good cjs libmusicbrainz5 evince gtksourceview3 webkitgtk \
     python2-dbus)
makedepends=(gnome-common gtk-doc intltool python2-distutils-extra gobject-introspection)
options=('!libtool' '!emptydirs')
source=("${pkgbase}-${pkgver}.tar.gz::https://github.com/linuxmint/nemo-extensions/archive/master.zip")
md5sums=('ecc7f8c34065d0bdb34778d53cf7b2fa')

prepare() {

    cd ${pkgbase}-master

    # Python2 fix
    find -type f | xargs sed -i 's@^#!.*python$@#!/usr/bin/python2@'
    
}

build() {
    cd ${pkgbase}-master

    _configure_pkgs="nemo-fileroller nemo-share nemo-seahorse"
    for dir in ${_configure_pkgs}
    do
      cd ${dir}
      autoreconf -fi
    	./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var \
                --disable-static --disable-schemas-compile
    	make
    	cd ..
    done

    #_autogen_pkgs="nemo-python nemo-preview"
    _autogen_pkgs="nemo-python"
    for dir in ${_autogen_pkgs}
    do
    	cd ${dir}
    	./autogen.sh --prefix=/usr --sysconfdir=/etc --localstatedir=/var \
                --disable-static
    	make
    	cd ..
    done

    # # nemo-pastebin
    # cd nemo-pastebin
    # python2 ./setup.py build --build-base ${srcdir}/build/ || return 1
    # cd ..

  	# nemo-media-columns
  	# Nothing to do here
  	# Required python2-pypdf from AUR

  	# nemo-compare
  	# cd nemo-compare

    # nemo-rabbitvcs
    # Nothing to do here

}

package_nemo-fileroller(){
	cd ${pkgbase}-master/nemo-fileroller

	pkgdesc="Nemo fileroller extension"
	arch=('i686' 'x86_64')
	depends=(nemo file-roller)
	make DESTDIR="${pkgdir}" install
}

package_nemo-share(){
	cd ${pkgbase}-master/nemo-share

	pkgdesc="Samba extension for Nemo"
	arch=('i686' 'x86_64')
	depends=(nemo samba)
	make DESTDIR="${pkgdir}" install
}

package_nemo-python() {
 cd ${pkgbase}-master/nemo-python

 pkgdesc="Python2 binding for Nemo components"
 arch=('i686' 'x86_64')
 depends=(nemo python2-gobject)

 make DESTDIR="${pkgdir}" install

}

package_nemo-seahorse(){
	cd ${pkgbase}-master/nemo-seahorse

	pkgdesc="Seahorse plugins and utilities for encryption"
  arch=('i686' 'x86_64')
	depends=(nemo seahorse gconf libgnome-keyring libcryptui)
  install=nemo-seahorse.install
	make DESTDIR="${pkgdir}" install
}

# package_nemo-media-columns(){
# 	cd ${pkgbase}-master/nemo-media-columns

# 	pkgdesc=("A Nemo extension to display music/EXIF and PDF metadata info in the Nemo List View")
# 	arch=(any)

#   install -d ${pkgdir}/usr/share/nemo-python/extensions/
# 	install -Dm755 ${srcdir}/nemo-media-columns.py \
# 			${pkgdir}/usr/share/nemo-python/extensions/nemo-media-columns.py
# }

# package_nemo-pastebin(){
# 	cd ${pkgbase}-master/nemo-pastebin

# 	pkgdesc="Nemo extension to send files to a pastebin"
# 	arch=(any)
# 	depends=(nemo pastebinit nemo-python)
#   install=nemo-pastebin.install

# 	python2 ./setup.py install --prefix=/usr --root=${pkgdir} \
# 		--no-compile -O0
# }

# package_nemo-preview(){
# 	cd ${pkgbase}-master/nemo-preview

# 	pkgdesc=("Nemo-preview is a GtkClutter and Javascript-based quick previewer for Nemo")
# 	arch=(any)
# 	depends=(nemo cjs libmusicbrainz5 evince gtksourceview3 webkitgtk clutter-gtk clutter-gst gst-plugins-good)

# 	make DESTDIR="${pkgdir}" install
# }

# package_nemo-compare() {
#   cd ${pkgbase}-master/nemo-compare

#   pkgdesc="Context menu comparison extension for Nemo file manager"
#   depends=(python2 python2-xdg meld nemo-python)

#   install -d ${pkgdir}/usr/share/applications/
#   install -d ${pkgdir}/usr/share/nemo-compare/

#   install -Dm755 ${srcdir}/data/nemo-compare-preferences.desktop \
#                   /usr/share/applications/nemo-compare-preferences.desktop
#   install -Dm755 ${srcdir}/data/nemo-compare-notification \
#                   /usr/share/nemo-compare/nemo-compare-notification
#   install -Dm755 ${srcdir}/src/nemo-compare.py \
#                   /usr/share/nemo-compare/nemo-compare.py
#   install -Dm755 ${srcdir}/src/utils.py \
#                   /usr/share/nemo-compare/utils.py
#   install -Dm755 ${srcdir}/src/nemo-compare-preferences.py \
#                   /usr/share/nemo-compare/nemo-compare-preferences.py

# }

# package_nemo-rabbitvcs(){
# 	cd ${pkgbase}-master/nemo-rabbitvcs

#   depends=(nemo-python python2-dbus)

#   install -d ${pkgdir}/usr/share/nemo-python/extensions/
#   install -Dm755 ${srcdir}/RabbitVCS.py \
#       ${pkgdir}/usr/share/nemo-python/extensions/RabbitVCS.py
# }

