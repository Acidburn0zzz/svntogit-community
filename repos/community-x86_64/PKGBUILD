# Maintainer: David Runge <dave@sleepmap.de>
pkgname=geonkick
pkgver=1.8
pkgrel=1
pkgdesc="A free software percussion synthesizer"
arch=('x86_64')
url="https://gitlab.com/iurie/geonkick"
license=('GPL3')
groups=('pro-audio')
depends=('cairo' 'desktop-file-utils' 'hicolor-icon-theme' 'shared-mime-info')
makedepends=('cmake' 'jack' 'lv2' 'sord' 'rapidjson' 'redkite')
optdepends=('jack: for standalone application')
source=("https://gitlab.com/iurie/geonkick/-/archive/v${pkgver}/$pkgname-v$pkgver.tar.gz")
sha512sums=('c3d2f10696720b674a9abc35b646dd3ee13e03aa92551265bb5c466b693aee6b9e4ae93aaa9746695d6faf1c4e0a165b431d793138c826f4191bb638d7dd937b')

prepare() {
  mv -v "$pkgname-v$pkgver" "$pkgname-$pkgver"
  cd "$pkgname-$pkgver"
  mkdir -v build
  # fix hardcoded redkite headers location:
  # https://gitlab.com/quamplex/geonkick/issues/133
  sed -e 's|/usr/local/include|/usr/include|' -i CMakeLists.txt
}

build() {
  cd "$pkgname-$pkgver"
  (
    cd build
    cmake -DCMAKE_INSTALL_PREFIX=/usr \
          ..
    make
  )
}

# lv2_validate still fails on itself:
# https://gitlab.com/lv2/lv2/issues/27
# check() {
#   cd "$pkgname-$pkgver"
#   (
#     cd build
#     lv2_validate "../plugin/lv2/${pkgname}.lv2/"*.ttl
#   )
# }

package() {
  cd "$pkgname-$pkgver"
  (
    cd build
    make DESTDIR="$pkgdir/" install
  )
  install -vDm 644 "data/${pkgname}.desktop" \
    -t "${pkgdir}/usr/share/applications"
  install -vDm 644 examples/* \
    -t "${pkgdir}/usr/share/doc/${pkgname}/examples"
  install -vDm 644 README.md -t "${pkgdir}/usr/share/doc/${pkgname}"
}
