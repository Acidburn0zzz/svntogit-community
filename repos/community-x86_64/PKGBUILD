# $Id$
# Maintainer: dtw <dibble.at.thewrecker.dot.net>
# Contributor: William Rea <sillywilly@gmail.com>

pkgname=chromium-bsu
pkgver=0.9.12
pkgrel=1
pkgdesc="A 2d scrolling shooter"
url="http://www.reptilelabour.com/software/chromium/"
arch=('i686' 'x86_64')
license=('custom:artistic')
depends=('libpng' 'freealut' 'smpeg' 'mesa' 'libvorbis' 'openal>=1.6.372')
options=('!makeflags')
replaces=('chromium')
source=(http://www.reptilelabour.com/software/files/chromium/chromium-src-$pkgver.tar.gz \
	http://www.reptilelabour.com/software/files/chromium/chromium-data-$pkgver.tar.gz \
	0.9.12-freealut.patch \
	0.9.12-png.patch \
        0.9.12-gcc43.patch \
	chromium.sh \
	chromium.png \
	chromium.desktop)

build(){
  cd $startdir/src/Chromium-0.9
  patch -p0 -i ../0.9.12-freealut.patch || return 1
  patch -p0 -i ../0.9.12-png.patch || return 1
  patch -p0 < ../0.9.12-gcc43.patch || return 1
  sed -i -e "s:-O2 -DOLD_OPENAL:${CXXFLAGS}:" src/Makefile
	sed -i -e "s:-g:${CXXFLAGS}:" src-setup/Makefile
	sed -i -e "s:-O2:${CFLAGS}:" support/glpng/src/Makefile
  find . -type d -name CVS -exec rm -rf '{}' \; >& /dev/null

  ./configure --disable-setup --enable-vorbis
  #export ENABLE_SDL="no"
  #export ENABLE_SMPEG="no"
  export CXXFLAGS="$CXXFLAGS -DPKGBINDIR=\"/usr/bin\" -DPKGDATADIR=\"/usr/share/chromium\""
  make || return 1
  
  mkdir -p $startdir/pkg/usr/{share/chromium,bin}
  install -m755 bin/chromium $startdir/pkg/usr/bin
  cp -R data $startdir/pkg/usr/share/chromium
  install -D -m755 ../chromium.sh $startdir/pkg/etc/profile.d/chromium.sh
  install -D -m644 LICENSE $pkgdir/usr/share/licenses/$pkgname/LICENSE
}
md5sums=('969883f2f20f10cd6cdb380582f130c4'
         '173fdf76f1e4d7496142cd5662456a73'
         '0e251478e227304cdd2bc2da88835727'
         '5cc997ebf12f948bb66c8eb9868e81f0'
         '0f6d82b8b76274ea6f8639483577e491'
         'da06f626560291c5eea57a17d275466e'
         '139346e36c7c09cccf77541e7828fcf4'
         '6f11d89085e21d6e14f694aa16a53d24')
