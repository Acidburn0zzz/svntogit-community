From 8de5d71748c70144acc93e56c0f86065638f92ca Mon Sep 17 00:00:00 2001
From: Peter Simons <simons@cryp.to>
Date: Sat, 19 Oct 2019 16:13:18 +0200
Subject: [PATCH] Support the new MonadFail class introduced by ghc-8.8.1.

https://prime.haskell.org/wiki/Libraries/Proposals/MonadFail
---
 bencode.cabal              | 2 ++
 src/Data/BEncode/Parser.hs | 5 +++++
 2 files changed, 7 insertions(+)

diff --git a/src/Data/BEncode/Parser.hs b/src/Data/BEncode/Parser.hs
index 8e4cb0b..55a6160 100644
--- a/src/Data/BEncode/Parser.hs
+++ b/src/Data/BEncode/Parser.hs
@@ -1,3 +1,4 @@
+{-# LANGUAGE CPP #-}
 -----------------------------------------------------------------------------
 -- |
 -- Module      :  BParser
@@ -27,6 +28,7 @@ module Data.BEncode.Parser {-#
 
 import           Control.Applicative        hiding (optional)
 import           Control.Monad
+import qualified Control.Monad.Fail         as Fail
 import           Data.BEncode
 import qualified Data.ByteString.Lazy.Char8 as L
 import qualified Data.Map                   as Map
@@ -61,6 +63,9 @@ instance Monad BParser where
                                           Ok a b' -> runB (f a) b'
                                           Error str -> Error str
     return val = BParser $ Ok val
+#if MIN_VERSION_base(4,13,0)
+instance Fail.MonadFail BParser where
+#endif
     fail str = BParser $ \_ -> Error str
 
 instance Functor BParser where
