# $Id$
# Maintainer:  Bart≈Çomiej Piotrowski
# Contributor: Brad Fanella <bradfanella@archlinux.us>
# Contributor: Stefan Husmann <stefan-husmann@t-online.de>
# Contributor: Pierre-Paul Paquin <pierrepaulpaquin@gmail.com>
# Contributor: xduugu (.desktop and install files)

pkgname=mupdf
pkgver=0.9
pkgrel=2
pkgdesc="lightweight PDF viewer and toolkit written in portable C"
arch=('i686' 'x86_64')
url="http://mupdf.com"
license=('GPL3')
depends=('freetype2' 'libjpeg' 'jbig2dec' 'openjpeg' 'libxext' 'desktop-file-utils')
install=mupdf.install
source=("http://mupdf.com/download/$pkgname-$pkgver-source.tar.gz")
md5sums=('76640ee16a797a27fe49cc0eaa87ce3a')

build() {
    CFLAGS+=" -fPIC"
    CXXFLAGS+=" -fPIC"

	cd "$srcdir/$pkgname-$pkgver"
	make build=release prefix="$pkgdir/usr"
}

package() {
	# Install
	cd "$srcdir/$pkgname-$pkgver"
	make build=release prefix="${pkgdir}/usr" install

	# Rename executables
	msg "Renaming executables"
	cd "${pkgdir}/usr/bin"
	for i in pdf*; do 
		mv "$i" "$i-mupdf";
	done

	# Fix mupdf.desktop
	cd "$srcdir/$pkgname-$pkgver"
	sed -i "s/mupdf.xpm/mupdf/" debian/mupdf.desktop
  	sed -i "s/application\/x-pdf/application\/x-pdf/" debian/mupdf.desktop

	# Install other stuff
	cd "$srcdir/$pkgname-$pkgver/debian"
	install -Dm644 mupdf.desktop "$pkgdir/usr/share/applications/mupdf.desktop"
  	install -Dm644 mupdf.xpm "$pkgdir/usr/share/pixmaps/mupdf.xpm"

  	# Fix permissions
    chmod 644 $pkgdir/usr/lib/{libmuxps.a,libfitz.a,libmupdf.a}
}
