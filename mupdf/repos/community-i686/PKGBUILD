# Maintainer: Stefan Husmann <stefan-husmann@t-online.de>
# Contributor: Pierre-Paul Paquin <pierrepaulpaquin@gmail.com>
# Contributor: xduugu (.desktop and install files)

pkgname=mupdf
pkgver=0.7
pkgrel=2
pkgdesc="lightweight PDF viewer and toolkit written in portable C"
arch=('i686' 'x86_64')
url="http://mupdf.com"
license=('GPL3')
depends=('freetype2' 'libjpeg' 'jbig2dec' 'openjpeg' 'libxext')
install=mupdf.install
source=("http://mupdf.com/download/mupdf-$pkgver.tar.gz")
md5sums=('83adc4d14eb17835df791a9a0d1e8fa9')

build() {
  cd "$srcdir/$pkgname-$pkgver"
  install -d $pkgdir/usr/{bin,include,lib}
  make build=release prefix="$pkgdir/usr" install
  cd debian
  sed -i "s:mupdf.xpm:mupdf:g" mupdf.desktop
  sed -i "s:pplication\/x-pdf:application\/x-pdf:g" mupdf.desktop
  install -Dm644 mupdf.desktop "$pkgdir/usr/share/applications/mupdf.desktop"
  install -Dm644 mupdf.xpm "$pkgdir/usr/share/pixmaps/mupdf.xpm"
  install -Dm644 mupdf.1 "$pkgdir/usr/share/man/man1/mupdf.1"
# added the folowing to avoid conflicts with poppler/other pdf toolkits:
  for _file in pdf*.1
  do
    install -m644 "${_file}" "$pkgdir/usr/share/man/man1/${_file}-mupdf"
  done
  cd $pkgdir/usr/bin
  for _fff in pdf*
  do 
    cp ${_fff} ${_fff}-mupdf
    rm ${_fff}
  done
# fix permissions on libmupdf.a
  chmod 644 $pkgdir/usr/lib/libmupdf.a
}
