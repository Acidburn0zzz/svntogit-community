# Maintainer: Sven-Hendrik Haase <svenstaro@gmail.com>
# Contributor: Nikita Volodin <volodin.n at gmail dot com>

pkgname=keycloak
pkgver=7.0.1
pkgrel=1
pkgdesc="Open Source Identity and Access Management For Modern Applications and Services"
arch=('any')
url="http://www.keycloak.org/"
license=('Apache')
depends=('jdk8-openjdk')
makedepends=('maven' 'git')
source=("$pkgname-$pkgver.tar.gz::https://github.com/keycloak/keycloak/archive/${pkgver}.tar.gz"
        "keycloak.service")
sha512sums=('d70971588736e771afc62af10633c939e493e0562e5d55c0dd6e78f9bad78439fcef74b595190a36cebbe16fc4fd79743b29f40864caf1ad426b392a159ab4a1'
            'eefc589eb574a784a593e0331603178a71bc795b46a4cca41feb780e967079fd801c934378c5f0aa790651c0c7e24c7bf31d11f69cc986e83b608cfe90f7d738')

build() {
    cd $pkgname-$pkgver
    mvn -Pdistribution -pl distribution/server-dist -am -Dmaven.test.skip clean install
}

package() {
   mkdir -p "$pkgdir/opt"
   cd $pkgname-$pkgver
   ls distribution/server-dist/target/
   cp -r "distribution/server-dist/target/keycloak-$pkgver" "$pkgdir/opt/keycloak"

   install -Dm644 "$srcdir"/keycloak.service "$pkgdir"/usr/lib/systemd/system/keycloak.service
}

