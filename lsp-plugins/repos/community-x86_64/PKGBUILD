# Maintainer: David Runge <dvzrv@archlinux.org>

pkgname=lsp-plugins
pkgver=1.1.13
pkgrel=2
pkgdesc="Collection of free plugins compatible with LADSPA, LV2 and LinuxVST"
arch=('x86_64')
url="https://lsp-plug.in"
license=('LGPL3')
groups=('ladspa-plugins' 'lv2-plugins' 'pro-audio' 'vst-plugins')
depends=('cairo' 'gcc-libs' 'glibc' 'hicolor-icon-theme' 'libglvnd' 'libx11')
makedepends=('gendesk' 'imagemagick' 'ladspa' 'jack' 'libsndfile' 'lv2' 'php')
optdepends=('jack: for standalone applications')
source=("https://github.com/sadko4u/${pkgname}/archive/${pkgname}-${pkgver}.tar.gz"
        "${pkgname}.directory"
        "${pkgname}.menu")
sha512sums=('81d93f9a3ffb6b85df970f4f781fd42059671aff4f6725fb3e31c3c7f65596dc8981075d23af5fce7d88470dc811116e4ae1fdd9c6b069db6e9c4c9f81a3357a'
            'bcb450fe36057fe165f47e75551a353195b515f1ed3c42eb8d67b68d53f30335496d720ce949c195c679df857225e43a06cb4f3dc1a0a3c69ca0f3c1285c1acd'
            'bad742cb84ced757f5ef810c4e61efa10ade8a66105c7194d03b692d9b94eb10b4c4f6b89be63c77957e74187b53fac0731ddae254c02860b885c6d7fbe9c1fe')

_names=(
'comp-delay-mono'
'comp-delay-stereo'
'comp-delay-x2-stereo'
'compressor-lr'
'compressor-mono'
'compressor-ms'
'compressor-stereo'
'dyna-processor-lr'
'dyna-processor-mono'
'dyna-processor-ms'
'dyna-processor-stereo'
'expander-lr'
'expander-mono'
'expander-ms'
'expander-stereo'
'gate-lr'
'gate-mono'
'gate-ms'
'gate-stereo'
'graph-equalizer-x16-lr'
'graph-equalizer-x16-mono'
'graph-equalizer-x16-ms'
'graph-equalizer-x16-stereo'
'graph-equalizer-x32-lr'
'graph-equalizer-x32-mono'
'graph-equalizer-x32-ms'
'graph-equalizer-x32-stereo'
'impulse-responses-mono'
'impulse-responses-stereo'
'impulse-reverb-mono'
'impulse-reverb-stereo'
'latency-meter'
'limiter-mono'
'limiter-stereo'
'mb-compressor-lr'
'mb-compressor-mono'
'mb-compressor-ms'
'mb-compressor-stereo'
'multisampler-x12'
'multisampler-x12-do'
'multisampler-x24'
'multisampler-x24-do'
'multisampler-x48'
'multisampler-x48-do'
'oscillator-mono'
'para-equalizer-x16-lr'
'para-equalizer-x16-mono'
'para-equalizer-x16-ms'
'para-equalizer-x16-stereo'
'para-equalizer-x32-lr'
'para-equalizer-x32-mono'
'para-equalizer-x32-ms'
'para-equalizer-x32-stereo'
'phase-detector'
'profiler-mono'
'profiler-stereo'
'room-builder-mono'
'room-builder-stereo'
'sampler-mono'
'sampler-stereo'
'sc-compressor-lr'
'sc-compressor-mono'
'sc-compressor-ms'
'sc-compressor-stereo'
'sc-dyna-processor-lr'
'sc-dyna-processor-mono'
'sc-dyna-processor-ms'
'sc-dyna-processor-stereo'
'sc-expander-lr'
'sc-expander-mono'
'sc-expander-ms'
'sc-expander-stereo'
'sc-gate-lr'
'sc-gate-mono'
'sc-gate-ms'
'sc-gate-stereo'
'sc-limiter-mono'
'sc-limiter-stereo'
'sc-mb-compressor-lr'
'sc-mb-compressor-mono'
'sc-mb-compressor-ms'
'sc-mb-compressor-stereo'
'slap-delay-mono'
'slap-delay-stereo'
'spectrum-analyzer-x1'
'spectrum-analyzer-x12'
'spectrum-analyzer-x16'
'spectrum-analyzer-x2'
'spectrum-analyzer-x4'
'spectrum-analyzer-x8'
'trigger-midi-mono'
'trigger-midi-stereo'
'trigger-mono'
'trigger-stereo'
)
_sizes=('16' '22' '24' '26' '32' '36' '48' '64' '72' '96' '128' '192' '256'
'384' '512' '1024')

prepare() {
  mv -v "$pkgname-$pkgname-$pkgver" "$pkgname-$pkgver"
  cd "$pkgname-$pkgver"
  declare -A comments=(
    ["comp-delay-mono"]="Add short delay to the mono channel to compensate the phase offset relatively to other channels."
    ["comp-delay-stereo"]="Add short delay to the stereo channel to compensate the phase offset relatively to other channels."
    ["comp-delay-x2-stereo"]="Add short delay to each individual channel of the stereo channel to compensate the phase offset relatively to other channels."
    ["compressor-lr"]="Performs compression of stereo input signal by applying individual processing to left and right channels separately."
    ["compressor-mono"]="Performs compression of mono input signal."
    ["compressor-ms"]="Performs compression of stereo input signal in Mid-Side mode."
    ["compressor-stereo"]="Performs compression of stereo input signal."
    ["dyna-processor-lr"]="Performs dynamic processing of stereo input signal by applying individual processing to left and right channels separately."
    ["dyna-processor-mono"]="Performs dynamic processing of mono input signal."
    ["dyna-processor-ms"]="Performs dynamic processing of stereo input signal in Mid-Side mode."
    ["dyna-processor-stereo"]="Performs dynamic processing of stereo input signal."
    ["expander-lr"]="Performs increasing of dynamic range of stereo input signal by applying individual processing to left and right channels separately."
    ["expander-mono"]="Performs increasing of dynamic range of mono input signal."
    ["expander-ms"]="Performs increasing of dynamic range of stereo input signal in Mid-Side mode."
    ["expander-stereo"]="Performs increasing of dynamic range of stereo input signal."
    ["gate-lr"]="Performs gating of stereo input signal by applying individual processing to left and right channels separately."
    ["gate-mono"]="Performs gating of mono input signal."
    ["gate-ms"]="Performs gating of stereo input signal in Mid-Side mode."
    ["gate-stereo"]="Performs gating of stereo input signal."
    ["graph-equalizer-x16-lr"]="Performs graphic equalization of stereo channel by applying individual equalization to left and right channels separately. Up to 16 frequency bands are available for correction in range of 72 dB (-36..+36 dB)."
    ["graph-equalizer-x16-mono"]="Performs graphic equalization of mono channel. Up to 16 frequency bands are available for correction in range of 72 dB (-36..+36 dB)."
    ["graph-equalizer-x16-ms"]="Performs graphic equalization of stereo channel in Mid-Side mode. Up to 16 frequency bands are available for correction in range of 72 dB (-36..+36 dB)."
    ["graph-equalizer-x16-stereo"]="Performs graphic equalization of stereo channel. Up to 16 frequency bands are available for correction in range of 72 dB (-36..+36 dB)."
    ["graph-equalizer-x32-lr"]="Performs graphic equalization of stereo channel by applying individual equalization to left and right channels separately. Up to 32 frequency bands are available for correction in range of 72 dB (-36..+36 dB)."
    ["graph-equalizer-x32-mono"]="Performs graphic equalization of mono channel. Up to 32 frequency bands are available for correction in range of 72 dB (-36..+36 dB)."
    ["graph-equalizer-x32-ms"]="Performs graphic equalization of stereo channel in Mid-Side mode. Up to 32 frequency bands are available for correction in range of 72 dB (-36..+36 dB)."
    ["graph-equalizer-x32-stereo"]="Performs graphic equalization of stereo channel. Up to 32 frequency bands are available for correction in range of 72 dB (-36..+36 dB)."
    ["impulse-responses-mono"]="Performs highly optimized real time zero-latency convolution to the input signal. It can be used as a cabinet emulator, some sort of equalizer or as a reverb simulation."
    ["impulse-responses-stereo"]="Performs highly optimized real time zero-latency convolution to the input signal. It can be used as a cabinet emulator, some sort of equalizer or as a reverb simulation."
    ["impulse-reverb-mono"]="Performs highly optimized real time zero-latency convolution to the input signal. It can be used as a cabinet emulator, some sort of equalizer or as a reverb simulation."
    ["impulse-reverb-stereo"]="Performs highly optimized real time zero-latency convolution to the input signal. It can be used as a cabinet emulator, some sort of equalizer or as a reverb simulation."
    ["latency-meter"]="Allows to measure the latency of a transmission line by using chirp - inverse filter convolution. Latency is determined as the lag of the convolution peak."
    ["limiter-mono"]="Implements a brick-wall limiter with flexible configuration. It prevents input monosignal from raising over the specified Threshold."
    ["limiter-stereo"]="Implements a brick-wall limiter with flexible configuration. It prevents input monosignal from raising over the specified Threshold."
    ["mb-compressor-lr"]="Performs multiband compression of stereo input signal by applying individual processing to left and right channels separately."
    ["mb-compressor-mono"]="Performs multiband compression of mono input signal."
    ["mb-compressor-ms"]="Performs multiband compression of stereo input signal in Mid-Side mode."
    ["mb-compressor-stereo"]="Performs multiband compression of stereo input signal."
    ["multisampler-x12"]="Implements 1-instrument MIDI sample player with stereo input and stereo output."
    ["multisampler-x12-do"]="Implements 12-instrument MIDI sample player with stereo input and stereo output."
    ["multisampler-x24"]="Implements 24-instrument MIDI sample player with stereo input and stereo output."
    ["multisampler-x24-do"]="Implements 1-instrument MIDI sample player with stereo input and stereo output."
    ["multisampler-x48"]="Implements 1-instrument MIDI sample player with stereo input and stereo output."
    ["multisampler-x48-do"]="Implements 48-instrument MIDI sample player with stereo input and stereo output."
    ["oscillator-mono"]="Implements a simple yet flexible utility signal generator. It can be used to provide reference waves in replacement, additive and multiplicative (modulation) Mode."
    ["para-equalizer-x16-lr"]="Performs parametric equalization of stereo channel by applying individual equalization to left and right channels separately. Up to 16 filters are available for signal processing simultaneously."
    ["para-equalizer-x16-mono"]="Performs parametric equalization of mono channel. Up to 16 filters are available for signal processing simultaneously."
    ["para-equalizer-x16-ms"]="Performs parametric equalization of stereo channel in Mid-Side mode. Up to 16 filters are available for signal processing simultaneously."
    ["para-equalizer-x16-stereo"]="Performs parametric equalization of stereo channel. Up to 16 filters are available for signal processing simultaneously."
    ["para-equalizer-x32-lr"]="Performs parametric equalization of stereo channel by applying individual equalization to left and right channels separately. Up to 32 filters are available for signal processing simultaneously."
    ["para-equalizer-x32-mono"]="Performs parametric equalization of mono channel. Up to 32 filters are available for signal processing simultaneously."
    ["para-equalizer-x32-ms"]="Performs parametric equalization of stereo channel in Mid-Side mode. Up to 32 filters are available for signal processing simultaneously."
    ["para-equalizer-x32-stereo"]="Performs parametric equalization of stereo channel. Up to 32 filters are available for signal processing simultaneously."
    ["phase-detector"]="Allows to detect phase between two sources."
    ["profiler-mono"]="Allows to profile audio systems (mono) based on the Synchronized Swept Sine method by Antonin Novak."
    ["profiler-stereo"]="Allows to profile audio systems (stereo) based on the Synchronized Swept Sine method by Antonin Novak."
    ["room-builder-mono"]="Allows to simulate mono impulse response of any modelled room or space."
    ["room-builder-stereo"]="Allows to simulate stereo impulse response of any modelled room or space."
    ["sampler-mono"]="Implements single-note MIDI sample player with mono input and mono output."
    ["sampler-stereo"]="Implements single-note MIDI sample player with stereo input and stereo output."
    ["sc-compressor-lr"]="Performs compression of stereo input signal by applying individual processing to left and right channels separately. Flexible sidechain-control configuration and additional sidechain inputs are provided."
    ["sc-compressor-mono"]="Performs compression of mono input signal. Flexible sidechain-control configuration and additional sidechain input are provided."
    ["sc-compressor-ms"]="Performs compression of stereo input signal in Mid-Side mode. Flexible sidechain-control configuration and additional sidechain inputs are provided."
    ["sc-compressor-stereo"]="Performs compression of stereo input signal. Flexible sidechain-control configuration and additional sidechain inputs are provided."
    ["sc-dyna-processor-lr"]="Performs dynamic processing of stereo input signal by applying individual processing to left and right channels separately. Flexible sidechain-control configuration and additional sidechain inputs are provided."
    ["sc-dyna-processor-mono"]="Performs dynamic processing of mono input signal. Flexible sidechain-control configuration and additional sidechain input are provided."
    ["sc-dyna-processor-ms"]="Performs dynamic processing of stereo input signal in Mid-Side mode. Flexible sidechain-control configuration and additional sidechain inputs are provided."
    ["sc-dyna-processor-stereo"]="Performs dynamic processing of stereo input signal. Flexible sidechain-control configuration and additional sidechain inputs are provided."
    ["sc-expander-lr"]="Performs increasing of dynamic range of stereo input signal by applying individual processing to left and right channels separately. Flexible sidechain-control configuration and additional sidechain inputs are provided."
    ["sc-expander-mono"]="Performs increasing of dynamic range of mono input signal. Flexible sidechain-control configuration and additional sidechain input are provided."
    ["sc-expander-ms"]="Performs increasing of dynamic range of stereo input signal in Mid-Side mode. Flexible sidechain-control configuration and additional sidechain inputs are provided."
    ["sc-expander-stereo"]="Performs increasing of dynamic range of stereo input signal. Flexible sidechain-control configuration and additional sidechain inputs are provided."
    ["sc-gate-lr"]="Performs gating of stereo input signal by applying individual processing to left and right channels separately. Flexible sidechain-control configuration and additional sidechain inputs are provided."
    ["sc-gate-mono"]="Performs gating of mono input signal. Flexible sidechain-control configuration and additional sidechain input are provided."
    ["sc-gate-ms"]="Performs gating of stereo input signal in Mid-Side mode. Flexible sidechain-control configuration and additional sidechain inputs are provided."
    ["sc-gate-stereo"]="Performs gating of stereo input signal. Flexible sidechain-control configuration and additional sidechain inputs are provided."
    ["sc-limiter-mono"]="Implements a brick-wall limiter with flexible configuration. It prevents input monosignal from raising over the specified Threshold. Additional sidechain inputs are provided for better use."
    ["sc-limiter-stereo"]="Implements a brick-wall limiter with flexible configuration. It prevents input monosignal from raising over the specified Threshold. Additional sidechain inputs are provided for better use."
    ["sc-mb-compressor-lr"]="Performs multiband compression of stereo input signal by applying individual processing to left and right channels separately. Flexible sidechain-control configuration and additional sidechain inputs are provided."
    ["sc-mb-compressor-mono"]="Performs multiband compression of mono input signal. Flexible sidechain-control configuration and additional sidechain input are provided."
    ["sc-mb-compressor-ms"]="Performs multiband compression of stereo input signal in Mid-Side mode. Flexible sidechain-control configuration and additional sidechain inputs are provided."
    ["sc-mb-compressor-stereo"]="Performs multiband compression of stereo input signal. Flexible sidechain-control configuration and additional sidechain inputs are provided."
    ["slap-delay-mono"]="Allows to add set of short delays of the original (mono) signal to the output mix. Each delay can be used to simulate the early reflections of the signal from walls."
    ["slap-delay-stereo"]="Allows to add set of short delays of the original (stereo) signal to the output mix. Each delay can be used to simulate the early reflections of the signal from walls."
    ["spectrum-analyzer-x1"]="Performs spectral analysis of a single audio channel. It does not affect any changes to the input signal, so can be placed anywhere where the metering is needed."
    ["spectrum-analyzer-x12"]="Performs spectral analysis of 12 independent channels simultaneously. Stereo channels also are possible to analyze by utilizing special modes and selecting corresponsing channels."
    ["spectrum-analyzer-x16"]="Performs spectral analysis of 16 independent channels simultaneously. Stereo channels also are possible to analyze by utilizing special modes and selecting corresponsing channels."
    ["spectrum-analyzer-x2"]="Performs spectral analysis of a pair of audio channels. Stereo channels also are possible to analyze by utilizing special modes and selecting corresponsing channels."
    ["spectrum-analyzer-x4"]="Performs spectral analysis of 4 independent channels simultaneously. Stereo channels also are possible to analyze by utilizing special modes and selecting corresponsing channels."
    ["spectrum-analyzer-x8"]="Performs spectral analysis of 8 independent channels simultaneously. Stereo channels also are possible to analyze by utilizing special modes and selecting corresponsing channels."
    ["trigger-midi-mono"]="Implements trigger with mono input and mono output. Additional MIDI output is provided to pass notes generated by the trigger."
    ["trigger-midi-stereo"]="Implements trigger with mono input and mono output. Additional MIDI output is provided to pass notes generated by the trigger."
    ["trigger-mono"]="Implements trigger with mono input and mono output."
    ["trigger-stereo"]="Implements trigger with mono input and mono output."
  )
  declare -A generic=(
    ["comp-delay-mono"]="Mono Delay Compensator"
    ["comp-delay-stereo"]="Stereo Delay Compensator"
    ["comp-delay-x2-stereo"]="Split Stereo Delay Compensator"
    ["compressor-lr"]="Split Stereo Compressor"
    ["compressor-mono"]="Mono Compressor"
    ["compressor-ms"]="Mid-Side Stereo Compressor"
    ["compressor-stereo"]="Stereo Compressor"
    ["dyna-processor-lr"]="Split Stereo Dynamic Processor"
    ["dyna-processor-mono"]="Mono Dynamic Processor"
    ["dyna-processor-ms"]="Mid-Side Stereo Dynamic Processor"
    ["dyna-processor-stereo"]="Stereo Dynamic Processor"
    ["expander-lr"]="Split Stereo Expander"
    ["expander-mono"]="Mono Expander"
    ["expander-ms"]="Mid-Side Stereo Expander"
    ["expander-stereo"]="Stereo Expander"
    ["gate-lr"]="Split Stereo Gate"
    ["gate-mono"]="Mono Gate"
    ["gate-ms"]="Mid-Side Stereo Gate"
    ["gate-stereo"]="Stereo Gate"
    ["graph-equalizer-x16-lr"]="Split Stereo 16 Band Graphic Equalizer"
    ["graph-equalizer-x16-mono"]="Mono 16 Band Graphic Equalizer"
    ["graph-equalizer-x16-ms"]="Mid-Side Stereo 16 Band Graphic Equalizer"
    ["graph-equalizer-x16-stereo"]="Stereo 16 Band Graphic Equalizer"
    ["graph-equalizer-x32-lr"]="Split Stereo 32 Band Graphic Equalizer"
    ["graph-equalizer-x32-mono"]="Mono 16 Band Graphic Equalizer"
    ["graph-equalizer-x32-ms"]="Mid-Side Stereo 32 Band Graphic Equalizer"
    ["graph-equalizer-x32-stereo"]="Stereo 32 Band Graphic Equalizer"
    ["impulse-responses-mono"]="Mono Convolution"
    ["impulse-responses-stereo"]="Stereo Convolution"
    ["impulse-reverb-mono"]="Mono Convolution Reverb"
    ["impulse-reverb-stereo"]="Stereo Convolution Reverb"
    ["latency-meter"]="Latency Meter"
    ["limiter-mono"]="Mono Limiter"
    ["limiter-stereo"]="Stereo Limiter"
    ["mb-compressor-lr"]="Split Stereo Multiband Compressor"
    ["mb-compressor-mono"]="Mono Multiband Compressor"
    ["mb-compressor-ms"]="Mid-Side Stereo Multiband Compressor"
    ["mb-compressor-stereo"]="Stereo Multiband Compressor"
    ["multisampler-x12"]="Stereo 12 Instrument Sample Player"
    ["multisampler-x12-do"]="Direct Out 12 Instrument Sample Player"
    ["multisampler-x24"]="Stereo 24 Instrument Sample Player"
    ["multisampler-x24-do"]="Direct Out 24 Instrument Sample Player"
    ["multisampler-x48"]="Stereo 48 Instrument Sample Player"
    ["multisampler-x48-do"]="Direct out 48 Instrument Sample Player"
    ["oscillator-mono"]="Mono Signal Generator"
    ["para-equalizer-x16-lr"]="Split Stereo 16 Band Parametric Equalizer"
    ["para-equalizer-x16-mono"]="Mono 16 Band Parametric Equalizer"
    ["para-equalizer-x16-ms"]="Mid-Side Stereo 16 Band Parametric Equalizer"
    ["para-equalizer-x16-stereo"]="Stereo 16 Band Parametric Equalizer"
    ["para-equalizer-x32-lr"]="Split Stereo 32 Band Parametric Equalizer"
    ["para-equalizer-x32-mono"]="Mono 32 Band Parametric Equalizer"
    ["para-equalizer-x32-ms"]="Mid-Side Stereo 32 Band Parametric Equalizer"
    ["para-equalizer-x32-stereo"]="Stereo 32 Band Parametric Equalizer"
    ["phase-detector"]="Phase Detector"
    ["profiler-mono"]="Mono Audio Profiler"
    ["profiler-stereo"]="Stereo Audio Profiler"
    ["room-builder-mono"]="Mono Room Impulse Response Builder"
    ["room-builder-stereo"]="Stereo Room Impulse Response Builder"
    ["sampler-mono"]="Mono MIDI Sample Player"
    ["sampler-stereo"]="Stereo MIDI Sample Player"
    ["sc-compressor-lr"]="Split Stereo Sidechain Compressor"
    ["sc-compressor-mono"]="Mono Sidechain Compressor"
    ["sc-compressor-ms"]="Mid-Side Stero Sidechain Compressor"
    ["sc-compressor-stereo"]="Stero Sidechain Compressor"
    ["sc-dyna-processor-lr"]="Split Stereo Dynamic Sidechain Processor"
    ["sc-dyna-processor-mono"]="Mono Dynamic Sidechain Processor"
    ["sc-dyna-processor-ms"]="Mid-Side Stereo Dynamic Sidechain Processor"
    ["sc-dyna-processor-stereo"]="Stereo Dynamic Sidechain Processor"
    ["sc-expander-lr"]="Split Stereo Sidechain Expander"
    ["sc-expander-mono"]="Mono Sidechain Expander"
    ["sc-expander-ms"]="Mid-Side Stereo Sidechain Expander"
    ["sc-expander-stereo"]="Stereo Sidechain Expander"
    ["sc-gate-lr"]="Split Stereo Sidechain Gate"
    ["sc-gate-mono"]="Mono Sidechain Gate"
    ["sc-gate-ms"]="Mid-Side Stereo Sidechain Gate"
    ["sc-gate-stereo"]="Stereo Sidechain Gate"
    ["sc-limiter-mono"]="Mono Sidechain Limiter"
    ["sc-limiter-stereo"]="Stereo Sidechain Limiter"
    ["sc-mb-compressor-lr"]="Split Stereo Sidechain Multiband Compressor"
    ["sc-mb-compressor-mono"]="Mono Sidechain Multiband Compressor"
    ["sc-mb-compressor-ms"]="Mid-Side Stereo Sidechain Multiband Compressor"
    ["sc-mb-compressor-stereo"]="Stereo Sidechain Multiband Compressor"
    ["slap-delay-mono"]="Mono Slap Delay"
    ["slap-delay-stereo"]="Stereo Slap Delay"
    ["spectrum-analyzer-x1"]="One Channel Spectrum Analyzer"
    ["spectrum-analyzer-x12"]="12 Channel Spectrum Analyzer"
    ["spectrum-analyzer-x16"]="16 Channel Spectrum Analyzer"
    ["spectrum-analyzer-x2"]="Two Channel Spectrum Analyzer"
    ["spectrum-analyzer-x4"]="Four Channel Spectrum Analyzer"
    ["spectrum-analyzer-x8"]="Eight Channel Spectrum Analyzer"
    ["trigger-midi-mono"]="Mono MIDI Trigger"
    ["trigger-midi-stereo"]="Stereo MIDI Trigger"
    ["trigger-mono"]="Mono Audio Trigger"
    ["trigger-stereo"]="Stereo Audio Trigger"
  )
  for name in "${_names[@]}"; do
    gendesk -n \
            --pkgname "in.lsp_plug.${pkgname//-/_}_${name//-/_}" \
            --name "${pkgname}-${name}" \
            --exec "${pkgname}-${name}" \
            --icon "${pkgname}" \
            --pkgdesc "${comments[$name]}" \
            --genericname "${generic[$name]}" \
            --categories "${pkgname}"
  done
  for size in "${_sizes[@]}"; do
    convert res/art/logo-large.png -resize "${size}x${size}" "${size}x${size}.png"
  done
}

build() {
  local _test_path="$(pwd)/.build-test"
  cd "$pkgname-$pkgver"
  make
  make OBJDIR="${_test_path}" clean
  make OBJDIR="${_test_path}" test
}

check() {
  local _test_path="$(pwd)/.build-test"
  cd "$pkgname-$pkgver"
  "${_test_path}/lsp-plugins-test" utest \
    --nofork \
    --debug \
    --verbose || echo "Known flaky test: https://github.com/sadko4u/lsp-plugins/issues/19"
}

package() {
  depends+=('libsndfile.so')
  cd "$pkgname-$pkgver"
  make BIN_PATH=/usr/bin \
       LIB_PATH=/usr/lib \
       DOC_PATH=/usr/share/doc \
       DESTDIR="$pkgdir/" \
       install
  # XDG desktop integration
  install -vDm 644 *.desktop -t "${pkgdir}/usr/share/applications"
  install -vDm 644 "../${pkgname}.menu" \
    -t "${pkgdir}/etc/xdg/menus/applications-merged/"
  install -vDm 644 "../${pkgname}.directory" \
    -t "${pkgdir}/usr/share/desktop-directories/"
  for size in "${_sizes[@]}"; do
    install -vDm 644 "${size}x${size}.png" \
      "${pkgdir}/usr/share/icons/hicolor/${size}x${size}/apps/${pkgname}.png"
  done
}
