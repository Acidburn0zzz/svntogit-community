# Contributor: Jaroslaw Swierczynski <swiergot@juvepoland.com>

pkgname=em8300
pkgver=0.17.4
_kernver=2.6.31-ARCH
pkgrel=1
pkgdesc="DXR3 and Hollywood+ driver"
arch=('i686' 'x86_64')
url="http://dxr3.sourceforge.net/"
license=('GPL2')
depends=('kernel26>=2.6.31' 'kernel26<2.6.32' "em8300-utils=$pkgver")
conflicts=(em8300-cvs)
replaces=(em8300-cvs)
install=em8300.install
#source=(http://dl.sourceforge.net/sourceforge/dxr3/$pkgname-$pkgver.tar.gz \
source=(http://dxr3.sourceforge.net/download/em8300-$pkgver-rc4.tar.gz)

build() {
  cd $srcdir/$pkgname-$pkgver-rc4/modules

  sed -i "s!^KERNEL_LOCATION := .*\$!KERNEL_LOCATION := /lib/modules/${_kernver}/build!" Makefile

  make || return 1
  make DESTDIR=$pkgdir install || return 1

  chmod 644 $pkgdir/lib/modules/*/em8300/*.ko
  sed -i -e "s/KERNEL_VERSION='.*'/KERNEL_VERSION='${_kernver}'/" $startdir/*.install
}
sha256sums=('4b7c566c5a6c058e8c82844cf960f008a4088561d0e08f1934a09b000f373c8a')
