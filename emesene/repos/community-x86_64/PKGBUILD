# $Id$
# Maintainer: Ronald van Haren <ronald.archlinux.org>
# Contributor: Claudio Riva <firetux83@gmail.com>

pkgname=emesene
pkgver=2.11.5
pkgrel=3
pkgdesc="A pygtk MSN Messenger client"
url="http://www.emesene.org/"
license=('custom:PSF' 'GPL' 'LGPL2.1')
arch=('i686' 'x86_64') # libmimic is hardcoded, so no 'any' package
#depends=('python2' 'pygtk' 'hicolor-icon-theme' 'xdg-utils')
depends=('python2' 'pygtk' 'python-dnspython' 'pylint' 'python-notify' 'openssl' \
'papyon' 'python-imaging' 'dbus-python' 'xdg-utils' 'hicolor-icon-theme')
makedepends=('python2-distribute')
optdepends=('gnome-python-extras: spell-check plugin'
	'gtkspell: spell-check plugin'
	'aspell: spell-check plugin (also need aspell dictionary)'
	'gstreamer0.10-python: webcam support'
	'gstreamer0.10-good-plugins: webcam support'
	'pywebkitgtk: for alternative conversation window' 
        'xmpppy: for gtalk and facebook chat support'
	'pyqt: alternative qt4 interface (emesene -e main:qt4_main')
source=("ftp://ftp.archlinux.org/other/community/${pkgname}/${pkgname}-${pkgver}.tar.gz"
        'emesene.run')
install=emesene.install
options=('!libtool')
sha1sums=('54e5fe81e99ddf5909b50c1c4f938480ed43f691'
          '2bd13ada86aa0af6307a41047f0d7caf2995660d')
build() {
  cd ${srcdir}/${pkgname}-${pkgver}

  # do not import dummy session
  #  sed -i -e  "/import dummy/d" emesene/emesene.py

  # install files
  export PYTHONPATH="${pkgdir}/usr/lib/python2.7/site-packages/"
  install -d ${pkgdir}/usr/lib/python2.7/site-packages/
  python2 setup.py install --prefix=${pkgdir}/usr
}

package() {
  cd ${pkgdir}

  # use /usr/share/emesene instead of /usr/lib/python2.5/site-packages
  mv -f ${pkgdir}/usr/lib/python2.7/site-packages/emesene-2.0-py2.7.egg/share \
        ${pkgdir}/usr
  mv -f ${pkgdir}/usr/lib/python2.7/site-packages/emesene-2.0-py2.7.egg/emesene \
        ${pkgdir}/usr/share
  rm -rf ${pkgdir}/usr/lib

  # python -> python2 
  find -name *.py -exec sed -i "s|/usr/bin/env python|/usr/bin/env python2|" {} \;

  # create executable
  install -Dm755 ${srcdir}/emesene.run ${pkgdir}/usr/bin/emesene
}
