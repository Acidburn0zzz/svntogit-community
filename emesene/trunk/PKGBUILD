# $Id$
# Maintainer: Ronald van Haren <ronald.archlinux.org>
# Contributor: Claudio Riva <firetux83@gmail.com>

pkgname=emesene
pkgver=2.11.11
pkgrel=1
pkgdesc="A pygtk MSN Messenger client"
url="http://www.emesene.org/"
license=('custom:PSF' 'GPL' 'LGPL2.1')
arch=('i686' 'x86_64') # libmimic is hardcoded, so no 'any' package
depends=('python2' 'pygtk' 'python-dnspython' 'pylint' 'python-notify' 'openssl' \
'papyon' 'python-imaging' 'dbus-python' 'xdg-utils' 'hicolor-icon-theme' \
'gstreamer0.10-python' 'gstreamer0.10-good')
makedepends=('python2-distribute')
optdepends=('gnome-python-extras: spell-check plugin'
	'gtkspell: spell-check plugin'
	'farsight2: webcam support'
	'pywebkitgtk: for alternative conversation window' 
        'xmpppy: for gtalk and facebook chat support'
	'pyqt: alternative qt4 interface (emesene -e main:qt4_main')
source=("${pkgname}-${pkgver}.tar.gz::https://github.com/emesene/emesene/tarball/v2.11.11"
        'emesene.run')
install=emesene.install
options=('!libtool')
sha1sums=('bf1c63d47617b746640950bd6aedf0fbe86e8743'
          '2bd13ada86aa0af6307a41047f0d7caf2995660d')
build() {
  cd ${srcdir}/${pkgname}-${pkgname}-c1bfdeb

  # do not import dummy session
  #  sed -i -e  "/import dummy/d" emesene/emesene.py

  # install files
  export PYTHONPATH="${pkgdir}/usr/lib/python2.7/site-packages/"
  install -d ${pkgdir}/usr/lib/python2.7/site-packages/
  python2 setup.py install --prefix=${pkgdir}/usr
}

package() {
  cd ${pkgdir}

  # use /usr/share/emesene instead of /usr/lib/python2.5/site-packages
  mv -f ${pkgdir}/usr/lib/python2.7/site-packages/emesene-${pkgver}-py2.7.egg/share \
        ${pkgdir}/usr
  mv -f ${pkgdir}/usr/lib/python2.7/site-packages/emesene-${pkgver}-py2.7.egg/emesene \
        ${pkgdir}/usr/share
  rm -rf ${pkgdir}/usr/lib

  # python -> python2 
  find -name *.py -exec sed -i "s|/usr/bin/env python|/usr/bin/env python2|" {} \;

  # create executable
  install -Dm755 ${srcdir}/emesene.run ${pkgdir}/usr/bin/emesene
}
