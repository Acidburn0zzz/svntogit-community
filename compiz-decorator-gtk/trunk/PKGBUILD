# $Id$
# Maintainer: Ronald van Haren <ronald.archlinux.org>
# Contributor: JJDaNiMoTh <jjdanimoth.aur@gmail.com>

pkgname=compiz-decorator-gtk
pkgver=0.8.4
pkgrel=3
pkgdesc="Decorator of Compiz for GNOME"
url="http://www.go-compiz.org/"
license=('GPL2' 'LGPL2' 'MIT')
arch=('i686' 'x86_64')
depends=('gnome-control-center>=2.30' 'compiz-core' 'libwnck>=2.30')
makedepends=('metacity>=2.28.1' 'intltool>=0.23')
groups=('compiz' 'compiz-gnome')
options=('!libtool' '!emptydirs')
conflicts=('compiz-git' 'compiz-decorator-gtk-git')
source=(http://releases.compiz.org/$pkgver/compiz-$pkgver.tar.gz
	gtk2.20.patch)
install=compiz-decorator-gtk.install
md5sums=('a4abe23a3f58b79a6706401aae426845'
	'c89283ff8721af260c66127707551c29')

build()
{
  cd $srcdir/compiz-$pkgver
  patch -Np1 -i $srcdir/gtk2.20.patch || return 1
  ./configure --prefix=/usr --sysconfdir=/etc \
	    --enable-gnome \
	    --disable-librsvg \
	    --enable-metacity \
	    --enable-gtk \
	    --enable-gconf \
	    --with-gconf-schema-file-dir=/etc/gconf/schemas \
	    --disable-dbus \
	    --disable-annotate \
	    --disable-kde || return 1

  make || return 1

  pushd gtk
  make DESTDIR=$pkgdir install || return 1
  mkdir -p $startdir/pkg/usr/share/gconf/schemas
  install -m644 window-decorator/gwd.schemas \
                $startdir/pkg/usr/share/gconf/schemas/gwd.schemas
  popd

  for i in dbus gconf ini inotify png regex svg glib kconfig
  do
    rm $startdir/src/compiz-$pkgver/metadata/compiz-$i.schemas
  done

  gconf-merge-schema \
    ${startdir}/pkg/usr/share/gconf/schemas/${pkgname}.schemas \
      	$startdir/src/compiz-$pkgver/metadata/*.schemas

  rm -rf ${startdir}/pkg/etc

# install MIT license
install -Dm644 $srcdir/compiz-$pkgver/COPYING.MIT \
	$pkgdir/usr/share/licenses/$pkgname/COPYING.MIT
}
