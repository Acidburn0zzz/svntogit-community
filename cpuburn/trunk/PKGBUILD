# $Id$
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>
# Contributor: Filip Wojciechowski, filip at loka dot pl

pkgname=cpuburn
pkgver=1.4a
pkgrel=1
pkgdesc="CPU testing utilities in optimized assembler for maximum loading of CPUs"
arch=('i686' 'x86_64')
url="http://pages.sbcglobal.net/redelm/"
license=('GPL')
depends=()
makedepends=('tar') # needs to be extracted manually because of malformed source file name
source=(http://pages.sbcglobal.net/redelm/cpuburn_${pkgver/./_}_tar.gz cpuburn.patch)
noextract=($pkgname_${pkgver/./_}_tar.gz)
md5sums=('a9e1df40c660324eb08e91847cbc41b9'
         'f3c77db7592ac02ee83958f07ceb8986')

build() {
  cd "$srcdir"

  # Workaround for malformed source file name
  mv cpuburn_${pkgver/./_}_tar.gz "$pkgname_$pkgver.tar.gz"
  tar zxf "$pkgname_$pkgver.tar.gz"

  cd "$pkgname-$pkgver"
  # a patch from debian/ubuntu patchset
  patch -Np1 -i ../cpuburn.patch
  make
  install -Dm755 burnBX $pkgdir/usr/bin/burnBX
  install -Dm755 burnK6 $pkgdir/usr/bin/burnK6
  install -Dm755 burnK7 $pkgdir/usr/bin/burnK7
  install -Dm755 burnMMX $pkgdir/usr/bin/burnMMX
  install -Dm755 burnP5 $pkgdir/usr/bin/burnP5
  install -Dm755 burnP6 $pkgdir/usr/bin/burnP6
  install -Dm644 README $pkgdir/usr/share/doc/$pkgname/README
  install -Dm644 Design $pkgdir/usr/share/doc/$pkgname/Design
}
