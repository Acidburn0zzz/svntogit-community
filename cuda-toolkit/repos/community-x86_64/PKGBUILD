# Maintainer: Sven-Hendrik Haase <sh@lutzhaase.com>

pkgname=cuda-toolkit
pkgver=4.0.17
_shortver=4.0
pkgrel=1
_fedver=13
pkgdesc="NVIDIA's CUDA architecture can be programmed in the only C language environment that unlocks the processing power of GPUs to solve the most complex compute-intensive challenges."
arch=('i686' 'x86_64')

url="http://www.nvidia.com/object/cuda_home.html"
license=('custom')
depends=('gcc-libs')
if [ "$CARCH" = "i686" ]; then
  _arch=32
  md5sums=('20d69b2d5bb7043ca7c2ad679c2825ed'
           '21b65dc8f1be42f2b42217b5f62963f2'
           'c0781c63e726eaf03e10135b42b85729')
else
  _arch=64
  md5sums=('152e1069f39fc8bbece875a1b9f576b6'
           '21b65dc8f1be42f2b42217b5f62963f2'
           'c0781c63e726eaf03e10135b42b85729')
fi

install=cuda-toolkit.install
source=(http://developer.download.nvidia.com/compute/cuda/4_0/toolkit/cudatoolkit_${pkgver}_linux_${_arch}_fedora${_fedver}.run
        cuda-toolkit.sh
        cuda-toolkit.conf
)

build() {
  cd "$srcdir"
}

package() {
  cd "$srcdir"

  mkdir -p $pkgdir/opt/cuda-toolkit
  sh cudatoolkit_${pkgver}_linux_${_arch}_fedora${_fedver}.run --keep -- --prefix=$pkgdir/opt/cuda-toolkit

  sed -i "/unsupported GNU/d" $pkgdir/opt/cuda-toolkit/include/host_config.h

  install -Dm755 cuda-toolkit.sh $pkgdir/etc/profile.d/cuda-toolkit.sh
  install -Dm644 cuda-toolkit.conf $pkgdir/etc/ld.so.conf.d/cuda-toolkit.conf
  install -Dm644 $pkgdir/opt/cuda-toolkit/doc/EULA.txt $pkgdir/usr/share/licenses/$pkgname/LICENSE
}
