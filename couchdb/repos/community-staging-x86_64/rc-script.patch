--- couchdb	2011-12-27 01:21:59.000000000 +0400
+++ couchdb.my	2011-12-27 01:21:18.000000000 +0400
@@ -1,6 +1,4 @@
-#!/bin/bash
-. /etc/rc.conf
-. /etc/rc.d/functions
+#!/bin/sh -e
 
 # Licensed under the Apache License, Version 2.0 (the "License"); you may not
 # use this file except in compliance with the License. You may obtain a copy of
@@ -31,7 +29,7 @@
 NAME=couchdb
 SCRIPT_NAME=`basename $0`
 COUCHDB=/usr/bin/couchdb
-CONFIGURATION_FILE=/etc/conf.d/couchdb
+CONFIGURATION_FILE=/etc/default/couchdb
 RUN_DIR=/var/run/couchdb
 LSB_LIBRARY=/lib/lsb/init-functions
 
@@ -44,14 +42,16 @@
 fi
 
 log_daemon_msg () {
-    stat_busy $@
+    # Dummy function to be replaced by LSB library.
+
+    echo $@
 }
 
 log_end_msg () {
+    # Dummy function to be replaced by LSB library.
+
     if test "$1" != "0"; then
-      stat_fail
-    else
-      stat_done
+      echo "Error with $DESCRIPTION: $NAME"
     fi
     return $1
 }
@@ -66,7 +66,7 @@
         command="$command $COUCHDB_OPTIONS"
     fi
     if test -n "$COUCHDB_USER"; then
-        if su $COUCHDB_USER -s /bin/bash -c "$command"; then
+        if su $COUCHDB_USER -c "$command"; then
             return $SCRIPT_OK
         else
             return $SCRIPT_ERROR
@@ -84,7 +84,6 @@
     # Start Apache CouchDB as a background process.
 
     mkdir -p "$RUN_DIR"
-    chown -R $COUCHDB_USER "$RUN_DIR"
     command="$COUCHDB -b"
     if test -n "$COUCHDB_STDOUT_FILE"; then
         command="$command -o $COUCHDB_STDOUT_FILE"
