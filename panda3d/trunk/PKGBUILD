# This is an example PKGBUILD file. Use this as a start to creating your own,
# and remove these comments. For more information, see 'man PKGBUILD'.
# NOTE: Please fill out the license field for your package! If it is unknown,
# then please put 'unknown'.

# See http://wiki.archlinux.org/index.php/Arch_CVS_&_SVN_PKGBUILD_guidelines
# for more information on packaging from CVS sources.

# Contributor: Your Name <youremail@domain.com>
pkgname=panda3d
pkgver=20090925
pkgrel=1
pkgdesc="panda3d cvs version"
arch=('i686' 'x86_64')
url="http://www.panda3d.org"
license=('BSD')
groups=()
depends=('python' 'freetype2' 'mesa' 'libtiff' 'openssl' 'ffmpeg' 'libpng' 'gtk2' 'libjpeg>=7' 'nvidia-cg-toolkit' 'tinyxml' 
'libsquish')
makedepends=('cvs')
provides=('panda3d')
conflicts=('panda3d')
replaces=()
backup=()
options=()
install=
source=('panda3d.profile' 'panda3d.pth')
noextract=()

_cvsroot=":pserver:anonymous@panda3d.cvs.sourceforge.net:/cvsroot/panda3d"
_cvsmod="panda3d"

# cvs -d:pserver:anonymous@panda3d.cvs.sourceforge.net:/cvsroot/panda3d login
# cvs -z3 -d:pserver:anonymous@panda3d.cvs.sourceforge.net:/cvsroot/panda3d co -P panda3d


build() {
  cd "$srcdir"
  msg "Connecting to $_cvsmod.sourceforge.net CVS server...."
  if [ -d $_cvsmod/CVS ]; then
    cd $_cvsmod
    cvs -q up -AdP
#    cvs -z3 update -d
  else
    cvs -z3 -d $_cvsroot co -D $pkgver -f $_cvsmod
    cd $_cvsmod
  fi

  msg "CVS checkout done or server timeout"
  msg "Starting make..."

  rm -rf "$srcdir/$_cvsmod-build"
  cp -r "$srcdir/$_cvsmod" "$srcdir/$_cvsmod-build"
  cd "$srcdir/$_cvsmod-build"


  #
  # BUILD HERE
  #

  makepanda/makepanda.py --everything --threads $((${MAKEFLAGS:2}-1)) --verbose  2>&1 > log|| return 1
  
  mkdir -p $pkgdir/opt/panda3d
  cp built/* $pkgdir/opt/panda3d -r
  cp models $pkgdir/opt/panda3d -r
  cp direct/src $pkgdir/opt/panda3d/direct -r
  
  # Remove undeeded directory
  rm -rf $pkgdir/opt/panda3d/tmp
  
  install -D $srcdir/panda3d.pth $pkgdir/usr/lib/python2.6/site-packages/panda3d.pth
  
  install -D -m755 $srcdir/panda3d.profile $pkgdir/etc/profile.d/panda3d.sh
  
}
md5sums=('17c522241e60779aa8e50d532bb94e13'
         'afd6e7a10573fbfb6f66ba2c0283117a')
