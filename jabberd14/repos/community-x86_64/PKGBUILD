# $Id$
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>
# Contributor: Sergej Pupykin <pupykin.s+arch@gmail.com>

pkgname=jabberd14
pkgver=1.6.1.1
pkgrel=10
pkgdesc="old (1.4) jabber server branch"
arch=(i686 x86_64)
url="http://jabberd.org/"
license=("GPL")
depends=(pth libidn expat popt gnutls)
optdepends=(libmysqlclient)
conflicts=(jabberd)
backup=(etc/jabberd/jabber.xml)
options=('!libtool')
source=(http://download.jabberd.org/jabberd14/jabberd14-$pkgver.tar.gz
	build-fix.patch
	jabberd)
md5sums=('597c7ee14518ba22b1cee883b4737d87'
         'ad795626f26c01700a23515e0e75d654'
         '5869169394d70977858320648075c7a6')

build() {
  cd $srcdir/jabberd14-$pkgver
  export LDFLAGS="$LDFLAGS -lgcrypt"
  [ $NOEXTRACT -eq 1 ] || ./configure --prefix=/usr --enable-ssl --enable-legacy --sysconfdir=/etc/jabberd --localstatedir=/var
  echo "#undef HAVE_GNUTLS_EXTRA" >>config.h
  [ $NOEXTRACT -eq 1 ] || patch -Rp1 <$srcdir/build-fix.patch
  make -j1
  make DESTDIR=$pkgdir install
  install -D -m 0755 $srcdir/jabberd $pkgdir/etc/rc.d/jabberd
  rm -rf $pkgdir/var/run
}
