# $Id$
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>
# Contributor: Stefan Husmann <stefan-husmann@t-online.de>
# Contributor: Giovanni Scafora <linuxmania@gmail.com>
# Maintainer: Daniel J Griffiths <ghost1227@archlinux.us>

pkgname=qcad
pkgver=3.0.14
pkgrel=1
pkgdesc="A 2D CAD package based upon Qt"
arch=('i686' 'x86_64')
url="http://www.ribbonsoft.com/qcad.html"
license=('GPL2')
depends=('qt4')
makedepends=('glu')
options=(libtool)
#source=($pkgname-$pkgver::https://github.com/qcad/qcad/archive/v$pkgver.tar.gz
source=("$pkgname::git://github.com/qcad/qcad.git#tag=v$pkgver"
        qcad.xpm
        QCad.desktop)
md5sums=('SKIP'
         'da32fec0d2fb85d96126bf28bb0ab9ff'
         'b4d1eb6724b4b41f191f1ab6fd859c39')

prepare() {
  cd ${srcdir}/${pkgname}
  sed -i '1,1i#include <unistd.h>' src/core/{RLocalPeer,RS}.cpp
  sed -i '1,1i#include <sys/sysinfo.h>' src/core/{RScriptHandler,RS}.cpp
}

build() {
  cd ${srcdir}/${pkgname}
  qmake-qt4
  make PREFIX=/usr CXX="g++ -fpermissive"
}

package() {
  cd ${srcdir}/${pkgname}

  install -d ${pkgdir}/usr/share/{qcad,pixmaps,applications}
  cp -r fonts patterns data library machines ${pkgdir}/usr/share/qcad

  install -Dm644 ../../qcad.xpm ${pkgdir}/usr/share/pixmaps/qcad.xpm
  install -Dm644 ../../QCad.desktop ${pkgdir}/usr/share/applications/QCad.desktop
}
