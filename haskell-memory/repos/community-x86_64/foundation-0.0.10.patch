From 1cf7f077d9fc2cec97677c3892b38ff74b157f07 Mon Sep 17 00:00:00 2001
From: Nicolas DI PRIMA <nicolas@di-prima.fr>
Date: Fri, 9 Jun 2017 14:54:04 +0200
Subject: [PATCH] bump Foundation dependency minimal version

fix #33
---
 Data/ByteArray/Types.hs | 6 +++---
 memory.cabal            | 2 +-
 stack.yaml              | 2 +-
 3 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/Data/ByteArray/Types.hs b/Data/ByteArray/Types.hs
index 0ad2797..87fdffe 100644
--- a/Data/ByteArray/Types.hs
+++ b/Data/ByteArray/Types.hs
@@ -55,16 +55,16 @@ uarrayRecastW8 :: F.PrimType ty => F.UArray ty -> F.UArray F.Word8
 uarrayRecastW8 = F.recast
 
 instance F.PrimType ty => ByteArrayAccess (F.UArray ty) where
-    length = F.length . uarrayRecastW8
+    length a = let F.CountOf i = F.length (uarrayRecastW8 a) in i
     withByteArray a f = F.withPtr (uarrayRecastW8 a) (f . castPtr)
 
 instance ByteArrayAccess F.String where
-    length = F.length
+    length str = let F.CountOf i = F.length str in i
     withByteArray s f = withByteArray (F.toBytes F.UTF8 s) f
 
 instance (Ord ty, F.PrimType ty) => ByteArray (F.UArray ty) where
     allocRet sz f = do
-        mba <- F.new (F.Size sz)
+        mba <- F.new (F.CountOf sz)
         a   <- F.withMutablePtr mba (f . castPtr)
         ba  <- F.unsafeFreeze mba
         return (a, ba)
diff --git a/memory.cabal b/memory.cabal
index 759035b..19cc1b4 100644
--- a/memory.cabal
+++ b/memory.cabal
@@ -96,7 +96,7 @@ Library
     Build-depends:   deepseq >= 1.1
   if flag(support_foundation)
     CPP-options:     -DWITH_FOUNDATION_SUPPORT
-    Build-depends:   foundation >= 0.0.8
+    Build-depends:   foundation >= 0.0.10
 
   ghc-options:       -Wall -fwarn-tabs
   default-language:  Haskell2010
