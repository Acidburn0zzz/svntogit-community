# Maintainer: David Runge <dvzrv@archlinux.org>

pkgname=irker
pkgver=2.18
pkgrel=2
pkgdesc="An IRC client that runs as a daemon accepting notification requests"
arch=('any')
url="https://gitlab.com/esr/irker"
license=('BSD')
depends=('python' 'python-pysocks')
makedepends=('docbook-xml' 'docbook-xsl' 'xmlto')
optdepends=('python-simplejson: alternative JSON backend for irkerhook.py')
backup=("etc/${pkgname}/irkerd.env")
source=("https://gitlab.com/esr/${pkgname}/-/archive/${pkgver}/${pkgname}-${pkgver}.tar.gz"
        "${pkgname}d.service"
        "${pkgname}d.env"
        "${pkgname}.sysusers"
        "${pkgname}.tmpfiles"
        "${pkgname}-2.18-makefile.patch::https://gitlab.com/esr/irker/-/commit/c75d52af5c5c040a84dadf229f950457a9e37c4e.patch"
        "${pkgname}-2.18-exception_irkerhook.patch::https://gitlab.com/esr/irker/-/commit/7b5019b8bdba49e24ca1cbc8b81f665e19f50ce1.patch"
        "${pkgname}-2.18-py3_irkerhook.patch::https://gitlab.com/esr/irker/-/commit/5a157b60e74045504cdbda30759a3f26e17712d9.patch"
)
sha512sums=('b60d5468515ee065d28f8215757fa2d6108d66afb5f28c807461854924196cc8cbbc8f6726102675b087e8c5a14d88e9e641b0522e32b53468b140cbf2e0eced'
            'f6a5c291258e0c341e3a5ba5fa2f6a43013be5c8faa5a372188854876cfe7f0dcd0bd979fa5627388216957103bfe1d002aefb74d51a620d05c16be87b639821'
            '734b98a72073f9b8168b141a4ebd2819eb5173a7e56b3ff3e843edc1db1107249764dcb4e3b5d95860e6d119d7b4abb8bfbe8b8a9c1398011d19dfd6dacd9d2d'
            '957a40e603783170fca8a4a4983cfdffa9b92918eb413b436341235685d59a1f05c49befa57239c0f5d5f72655b91b6f0dbe3cec07278f61c0e1ae9d7460e199'
            '5eb944a3f18dd23321d7ef31f0079c55be9af4f82e981a9071f21080e1bfbcb428ed6245dad8095ac2e3118d964d9b26b73d6786b8141354182b1b9cc3dcee2d'
            '3b9202bca3fd91933ce2fa76a55742f0d54cacd52dd468002fe6039e60e102b2c648691c137f8c5a72fa15d5cff945bc788c1b9b2a3516504327a51c2d5ddcd5'
            '8d6785647af1b5caa31fec8743e99bcfc4714a90b5b2de8c152b580204bf818721245eb8eb9d72b277c596ba9d9df39cc8b56ad5fe34d0b0a0e2014eb10da8ed'
            'bfbe4aff99a3faa7e62126a8017cc31b24200cc1236728b22bb47f36cfa9bd9bb3abfe6ee55a0b431714ee759b1fee2c13004b7c7e99d8a2b3b54fe6ae752edf')
b2sums=('f7ac24bb96ef04962da3769efd2730e9d6b25109459a8dfb9f8f150bacc78a9f22c98f75ce8332b070f41929e4b3c23da6c62bd7caa439d57cc1d5b2d13f1f52'
        '8f239dd9f03e7377572fb2f2f8a77004ddcf1ed423d93965b689296758214aa5e1913ff87bc889456f7ea248ee0a7d8edd18cbc8890814ef2b54c79b126eb80b'
        '7196806c47ba34a89aed6c27657767f444fdf5dd21ae309d5ab1617ee4f75f7f35f0fc7bb205cb339367e083debe74f54ddfb1c633d32d2106aa02e312cfbe0d'
        'e7bd8d0599588ab86650abc3ad731c106c4f0ac8afcc9963e343d18126589fe185438e4590c7dc93cbe5f60a40123100766145b9db6d73895853ebd9a3b66724'
        '91eb92bbf64ba92b461a637df8ed84a978950f439e4161b7a3a7486e87a64a0156790b11c621f4770adbdac33f82b2b284a9ac44222dc2140c162247c4164cb0'
        '0acc560d05a8ff84381e7f37817752b4fd93deffcd756046f046206e9b33140b0e6b84e9df09ebae2825c21f3f91883254861177e4c747a05d5054416b592be5'
        'b78a5736a15a36eafe04e689a3295d5c7530f05e0f6feefd5c029a6015f4558a20e6920f4a074aed4bee4b8963f94d565f4503d5e498eaa1057ead32457858f5'
        'bfa87ab00503d939c65274afdc58989b55be5277a3032b64de5c04fb7fb144602c1e2207bba818f1b98d27eb72f8b9cb40dcb2f4a14f75b15ff4fa556ba21d5a')

prepare() {
  cd "$pkgname-$pkgver"
  patch -Np1 -i "../${pkgname}-2.18-makefile.patch"
  patch -Np1 -i "../${pkgname}-2.18-exception_irkerhook.patch"
  patch -Np1 -i "../${pkgname}-2.18-py3_irkerhook.patch"
}

build() {
  cd "$pkgname-$pkgver"
  make
}

package() {
  cd "$pkgname-$pkgver"
  make DESTDIR="$pkgdir/" install
  install -vDm 755 {irk,irkerhook.py} -t "${pkgdir}/usr/bin"
  install -vDm 644 "../${pkgname}d.service" -t "${pkgdir}/usr/lib/systemd/system"
  install -vDm 640 "../${pkgname}d.env" -t "${pkgdir}/etc/${pkgname}"
  install -vDm 644 "../${pkgname}.sysusers" "${pkgdir}/usr/lib/sysusers.d/${pkgname}.conf"
  install -vDm 644 "../${pkgname}.tmpfiles" "${pkgdir}/usr/lib/tmpfiles.d/${pkgname}.conf"
  install -vDm 644 COPYING \
    -t "${pkgdir}/usr/share/licenses/${pkgname}"
  install -vDm 644 {NEWS,README,{hacking,security}.txt} \
    -t "${pkgdir}/usr/share/doc/${pkgname}"
}
