From 7e7cba8fc60db30789d75182cbc6cad1bdbb6f44 Mon Sep 17 00:00:00 2001
From: Erik de Castro Lopo <erikd@mega-nerd.com>
Date: Fri, 15 Apr 2016 14:41:55 +1000
Subject: [PATCH] yesod-persistent: Make it work with persistent 2.5

---
 yesod-persistent/Yesod/Persist/Core.hs  | 12 ++++++------
 yesod-persistent/yesod-persistent.cabal |  4 ++--
 2 files changed, 8 insertions(+), 8 deletions(-)

diff --git a/yesod-persistent/Yesod/Persist/Core.hs b/yesod-persistent/Yesod/Persist/Core.hs
index c566707..1a4f51d 100644
--- a/yesod-persistent/Yesod/Persist/Core.hs
+++ b/yesod-persistent/Yesod/Persist/Core.hs
@@ -124,9 +124,9 @@ respondSourceDB :: YesodPersistRunner site
 respondSourceDB ctype = respondSource ctype . runDBSource
 
 -- | Get the given entity by ID, or return a 404 not found if it doesn't exist.
-get404 :: (MonadIO m, PersistStore (PersistEntityBackend val), PersistEntity val)
-       => Key val
-       -> ReaderT (PersistEntityBackend val) m val
+get404 :: (PersistEntityBackend val ~ BaseBackend backend, MonadIO m
+          , PersistEntity val, PersistStoreRead backend)
+        => Key val -> ReaderT backend m val
 get404 key = do
     mres <- get key
     case mres of
@@ -135,9 +135,9 @@ get404 key = do
 
 -- | Get the given entity by unique key, or return a 404 not found if it doesn't
 --   exist.
-getBy404 :: (PersistUnique (PersistEntityBackend val), PersistEntity val, MonadIO m)
-         => Unique val
-         -> ReaderT (PersistEntityBackend val) m (Entity val)
+getBy404 :: (PersistEntityBackend val ~ BaseBackend backend, MonadIO m
+            , PersistEntity val, PersistUniqueRead backend)
+            => Unique val -> ReaderT backend m (Entity val)
 getBy404 key = do
     mres <- getBy key
     case mres of
diff --git a/yesod-persistent/yesod-persistent.cabal b/yesod-persistent/yesod-persistent.cabal
index a12ca07..b056555 100644
--- a/yesod-persistent/yesod-persistent.cabal
+++ b/yesod-persistent/yesod-persistent.cabal
@@ -16,8 +16,8 @@ extra-source-files: README.md ChangeLog.md
 library
     build-depends:   base                      >= 4        && < 5
                    , yesod-core                >= 1.4.0    && < 1.5
-                   , persistent                >= 2.1      && < 2.3
-                   , persistent-template       >= 2.1      && < 2.2
+                   , persistent                >= 2.5      && < 2.6
+                   , persistent-template       >= 2.5      && < 2.6
                    , transformers              >= 0.2.2
                    , blaze-builder
                    , conduit
