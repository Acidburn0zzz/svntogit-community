43c43
< #include <linux/videodev.h>
---
> #include <linux/videodev2.h>
64,65c64,65
<   struct video_window x_vidwin;
<   struct video_picture x_vidpic;
---
>   struct v4l2_window x_vidwin;
>   struct v4l2_pix_format x_vidfmt;
147c147
<   if( ioctl(x->x_vlfd, VIDIOCGPICT, &x->x_vidpic) == -1)
---
>   if( ioctl(x->x_vlfd, VIDIOC_G_FMT, &x->x_vidfmt) == -1)
149,150c149,150
<      post("pdp_vloopback : could get palette ( VIDIOCGPICT )");
<      perror( "ioctl VIDIOCGPICT" );
---
>      post("pdp_vloopback : could get palette ( VIDIOC_G_FMT )");
>      perror( "ioctl VIDIOC_G_FMT" );
154,155c154,155
<   x->x_vidpic.palette = VIDEO_PALETTE_RGB24;
<   if( ioctl(x->x_vlfd, VIDIOCSPICT, &x->x_vidpic) == -1)
---
>   x->x_vidfmt.pixelformat = V4L2_PIX_FMT_BGR24;
>   if( ioctl(x->x_vlfd, VIDIOC_S_FMT, &x->x_vidfmt) == -1)
157,158c157,158
<      post("pdp_vloopback : could set palette ( VIDIOCSPICT )");
<      perror( "ioctl VIDIOCSPICT" );
---
>      post("pdp_vloopback : could set palette ( VIDIOC_S_FMT )");
>      perror( "ioctl VIDIOC_S_FMT" );
163c163
<   if(ioctl (x->x_vlfd, VIDIOCGWIN, &x->x_vidwin) == -1)
---
>   if(ioctl (x->x_vlfd, VIDIOC_G_FMT, &x->x_vidwin) == -1)
165,166c165,166
<      post("pdp_vloopback : could get dimensions ( VIDIOCGWIN )");
<      perror( "ioctl VIDIOCGWIN" );
---
>      post("pdp_vloopback : could get dimensions ( VIDIOC_G_FMT )");
>      perror( "ioctl VIDIOC_G_FMT" );
170,171c170,171
<   x->x_vidwin.width = x->x_width;
<   x->x_vidwin.height = x->x_height;
---
>   x->x_vidwin.w.width = x->x_width;
>   x->x_vidwin.w.height = x->x_height;
173c173
<   if(ioctl (x->x_vlfd, VIDIOCSWIN, &x->x_vidwin) == -1)
---
>   if(ioctl (x->x_vlfd, VIDIOC_S_FMT, &x->x_vidwin) == -1)
175,176c175,176
<      post("pdp_vloopback : could set dimensions ( VIDIOCSWIN )");
<      perror( "ioctl VIDIOCSWIN" );
---
>      post("pdp_vloopback : could set dimensions ( VIDIOC_S_FMT )");
>      perror( "ioctl VIDIOC_S_FMT" );
