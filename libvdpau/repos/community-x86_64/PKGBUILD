pkgname=libvdpau
pkgver=190.42
pkgrel=1
pkgdesc="NVIDIA vdpau library"
arch=('i686' 'x86_64')
url="http://www.nvidia.com/"
conflicts=('nvidia-utils')
license=('custom')
source=("http://download.nvidia.com/XFree86/Linux-x86/${pkgver}/NVIDIA-Linux-x86-${pkgver}-pkg0.run"
	"http://download.nvidia.com/XFree86/Linux-x86_64/${pkgver}/NVIDIA-Linux-x86_64-${pkgver}-pkg0.run")
md5sums=('f94806feee87de756d14fe3e9bcaf05a'
         'ae431ff849ec01446e6724f9fcfe3bb4')

build() {
	[ "$CARCH" = "i686"   ] && _ARCH=x86
	[ "$CARCH" = "x86_64" ] && _ARCH=x86_64

	cd $srcdir
	sh NVIDIA-Linux-${_ARCH}-${pkgver}-pkg0.run --extract-only
	cd NVIDIA-Linux-${_ARCH}-${pkgver}-pkg0/usr/

	mkdir -p $pkgdir/usr/include/vdpau
	mkdir -p $pkgdir/usr/lib
	install -m644 include/vdpau/vdpau*.h $pkgdir/usr/include/vdpau

	install lib/{libvdpau_trace,libvdpau_nvidia,libvdpau}.so.${pkgver} \
	$pkgdir/usr/lib/ || return 1

	cd $pkgdir/usr/lib/
	ln -s libvdpau.so.$pkgver libvdpau.so.1 || return 1
	ln -s libvdpau.so.$pkgver libvdpau.so || return 1

	install -D -m644 $srcdir/NVIDIA-Linux-${_ARCH}-${pkgver}-pkg0/LICENSE $pkgdir/usr/share/licenses/$pkgname/license || return 1
}
