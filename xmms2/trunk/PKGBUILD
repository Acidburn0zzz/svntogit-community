# $Id$
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>

pkgname=xmms2
pkgver=0.6DrMattDestruction
pkgrel=5
pkgdesc="complete rewrite of the popular music player"
arch=('i686' 'x86_64')
url="http://xmms2.xmms.org/"
license=('LGPL')
backup=('etc/conf.d/xmms2d.conf')
depends=('sqlite3' 'libmad')
makedepends=('python' 'glib' 'sqlite3' 'curl' 'libmad' 'faad2' 'libvorbis'
	     'flac' 'libmpcdec' 'smbclient' 'libmms' 'ffmpeg'
	     'jack-audio-connection-kit' 'libxml2' 'pyrex'
	     'ruby' 'alsa-lib' 'boost')
optdepends=(libao fftw ffmpeg libxml2 smbclient jack-audio-connection-kit pulseaudio
	    wavpack mpg123 libmms avahi ruby curl libmpcdec)
conflicts=('xmms2-devel')
install=xmms2.install
options=('force')
source=(http://downloads.sourceforge.net/$pkgname/$pkgname-$pkgver.tar.bz2 \
	xmms2d.conf \
	xmms2d.rc \
	xmms2-helpers.patch)
md5sums=('954fb9c76b5db5e324a105e81b273200'
         'b3e92b8e2275efc478af775df7a57a13'
         '893371ba4dc7b428322e44329683211f'
         'eddb800ebcc495b8574044a110a34add')

build() {
  cd $startdir/src/$pkgname-$pkgver

  patch -Np1 < $srcdir/xmms2-helpers.patch
#  sed -i -e 's#avcodec.h#libavcodec/avcodec.h#' src/plugins/avcodec/avcodec.c

  ./waf configure --prefix=/usr \
	--with-optionals=python,cli,launcher,xmmsclient++,xmmsclient++-glib,perl,ruby,nycli || return 1
  ./waf build || return 1
  ./waf --destdir=$startdir/pkg install || return 1

  install -D -m 0755 ../xmms2d.rc $startdir/pkg/etc/rc.d/xmms2d && \
  install -D -m 0644 ../xmms2d.conf $startdir/pkg/etc/conf.d/xmms2d.conf
}
