# $Id$
# Maintainer: Felix Yan <felixonmars@archlinux.org>

pkgname=blinksocks
pkgver=3.2.1
pkgrel=1
pkgdesc='A framework for building composable proxy protocol stack.'
arch=('any')
url='https://github.com/blinksocks/blinksocks'
license=('Apache')
depends=('nodejs' 'semver')
makedepends=('npm')
source=(https://registry.npmjs.org/$pkgname/-/$pkgname-$pkgver.tgz
        blinksocks@.service)
noextract=($pkgname-$pkgver.tgz)
sha512sums=('772d835db20d84b845485422f04f070544341599322e1675b7f279481540567202f63e2209119728f0f5b1884e24ddf4e55025a4aba35942e4b9f75e68ce0971'
            '709153bb95492cf0d6fa070ad8eef16220a97896731f688ec79e03cfddf112b4475fff589490740a8dae33b7bc4c1a331a4baf0d190eaf219f193fbb8128abeb')

package() {
  npm install -g --user root --prefix "$pkgdir"/usr "$srcdir"/$pkgname-$pkgver.tgz

  # Why 777? :/
  chmod -R u=rwX,go=rX "$pkgdir"

  rm -r "$pkgdir"/usr/lib/node_modules/blinksocks/node_modules/{,.bin/}semver

  install -Dm644 "$srcdir/blinksocks@.service" "$pkgdir/usr/lib/systemd/system/blinksocks@.service"
}
