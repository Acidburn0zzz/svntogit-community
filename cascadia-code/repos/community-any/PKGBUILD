# Maintainer: Konstantin Gizdov <arch at kge dot pw>
# Contributor: Jerome Leclanche <jerome@leclan.ch>

pkgbase=cascadia-code
pkgname=("ttf-${pkgbase}" "otf-${pkgbase}" "woff2-${pkgbase}")
pkgver=2110.31
pkgrel=1
pkgdesc="A monospaced font by Microsoft that includes programming ligatures"
arch=("any")
url="https://github.com/microsoft/cascadia-code"
license=("custom:OFL")
source=(
    "${pkgname}-${pkgver}-release.zip::https://github.com/microsoft/${pkgbase}/releases/download/v${pkgver}/CascadiaCode-${pkgver}.zip"
    "${pkgname}-${pkgver}.tar.gz::https://github.com/microsoft/${pkgbase}/archive/v${pkgver}.tar.gz"
)
sha256sums=('b1a18b6b15818f5e5467f06363c963d7f373f26c41910284943076c064756fac'
            'b204fe8f8992b687e7fc90b2a7123f2e92360d48165e56810553553642b45c01')

function prepare() {
    cd "${srcdir}/otf/static"
    cp ./*.otf ../
}

function _package() {
    cd "${srcdir}/"

    local ext="${1%%-*}"
    local installdir="${ext^^}"
    local fonts=("${srcdir}/${ext}"/*."${ext}")

    # Install fonts
    install -d "${pkgdir}/usr/share/fonts/${installdir}"
    local font
    for font in "${fonts[@]}"; do
        install -m644 "${font}" "${pkgdir}/usr/share/fonts/${installdir}"
    done

    # Install license
    install -Dm644 "${srcdir}/${pkgbase}-${pkgver}/LICENSE" "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
}

for _pkgname in ${pkgname[@]}; do
    eval "function package_$_pkgname() { _package $_pkgname; }"
done
