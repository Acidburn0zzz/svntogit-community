# $Id$
# Maintainer: Alexander Fehr <pizzapunk gmail com>
# Contributor: Alessio 'mOLOk' Bolognino <themolok@gmail.com>

pkgname=tracker-gnome-search-tool
pkgver=0.6.6
pkgrel=2
pkgdesc="Gnome GUI for Tracker"
arch=('i686' 'x86_64')
url="http://www.gnome.org/projects/tracker/"
license=('GPL')
depends=('tracker' 'gnome-desktop' 'libnotify' 'xdg-utils')
makedepends=('intltool' 'deskbar-applet')
options=('!libtool')
install=tracker-gnome-search-tool.install
source=(http://www.gnome.org/~jamiemcc/tracker/tracker-$pkgver.tar.bz2)
md5sums=('0845998f8f0d715b3f1b306d59fdae4d')

build() {
  cd $startdir/src/tracker-$pkgver

  patch -p4 python/deskbar-handler/tracker-module.py <<EOF
--- /usr/lib/deskbar-applet/modules-2.20-compatible/tracker-module.py.orig 2008-09-09 21:04:59.000000000 +0200
+++ /usr/lib/deskbar-applet/modules-2.20-compatible/tracker-module.py 2008-09-09 21:05:11.000000000 +0200
@@ -11,7 +11,7 @@
 import os.path
 import deskbar
 import deskbar.core.Utils
-import deskbar.core.gnomedesktop
+import gnomedesktop
 import deskbar.interfaces.Module
 import deskbar.interfaces.Match
 import deskbar.interfaces.Action
EOF

  ./configure --prefix=/usr --sysconfdir=/etc \
    --enable-external-sqlite --enable-video-extractor=gstreamer --enable-file-monitoring=inotify \
    --disable-unac --disable-xmp \
    --enable-libtrackergtk --enable-preferences \
    --enable-gui --enable-trackerapplet --enable-deskbar-applet=module
  make || return 1
  make DESTDIR=$startdir/pkg install

  # Remove stuff provided by tracker package
  rm -f $startdir/pkg/etc/xdg/autostart/trackerd.desktop
  cd $startdir/pkg/usr/bin
  for file in *; do
    if [[ $file != "tracker-applet" && $file != "tracker-preferences" \
      && $file != "tracker-search-tool" ]]; then
      rm -f $file
    fi
  done
  rm -f $startdir/pkg/usr/include/tracker*
  rm -rf $startdir/pkg/usr/lib/{libtrackerclient*,pkgconfig/tracker.pc,tracker}
  rm -rf $startdir/pkg/usr/share/{dbus-1,icons,locale,man/man{5,7}}
  cd $startdir/pkg/usr/share/man/man1
  for file in *; do
    if [[ $file != "tracker-applet.1" && $file != "tracker-preferences.1" \
      && $file != "tracker-search-tool.1" ]]; then
      rm -f $file
    fi
  done
  rm -rf $startdir/pkg/usr/share/tracker/{languages,services,sqlite*,tracker-introspect.xml}
}
