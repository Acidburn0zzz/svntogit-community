# $Id$
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>

pkgname=gimmie
pkgver=0.2.8
pkgrel=7
pkgdesc="GNOME panel revisited"
arch=('i686' 'x86_64')
url="http://beatniksoftware.com/gimmie/Main_Page"
license=('LGPL')
depends=('gnome-desktop' 'libgnomecups' 'libwnck' 'dbus-python' 'gnome-python-desktop' 'gnome-menus')
makedepends=('findutils' 'perlxml')
install=gimmie.install
source=(http://www.beatniksoftware.com/gimmie/releases/$pkgname-$pkgver.tar.gz)
md5sums=('721b8ec80f0247e1281aeb4aa5614c2f')

build() {
  cd $startdir/src/$pkgname-$pkgver
  ./configure --prefix=/usr --libexecdir=/usr/lib/${pkgname}
  make || return 1
  for i in `find -name "*.py"` `find -name "*.pyc"`; do
    mkdir -p $startdir/pkg/usr/lib/`dirname "$i"`
    cp -vp "$i" $startdir/pkg/usr/lib/`dirname "$i"` || return 1
  done
  for i in `find -name "*.so"`; do
    mkdir -p $startdir/pkg/usr/lib/`dirname "$i"`
    cp -vp "$i" $startdir/pkg/usr/lib/`dirname "$i"`/.. || return 1
  done

  # install Gimmie related data
  mkdir -p $startdir/pkg/usr/etc/gconf/schemas &&
  cp -vp ./data/gimmie.schemas $startdir/pkg/usr/etc/gconf/schemas/
  mkdir -p $startdir/pkg/usr/lib/bonobo/servers &&
  cp -vp ./data/GNOME_GimmieApplet.server $startdir/pkg/usr/lib/bonobo/servers/ || return 1
  mkdir -p $startdir/pkg/usr/share/gnome-2.0/ui &&
  cp -vp ./data/GNOME_GimmieApplet.xml $startdir/pkg/usr/share/gnome-2.0/ui/ || return 1
  # install Gimmie icons
  mkdir -p $startdir/pkg/usr/share/icons/hicolor/32x32/apps &&
  cp -vp ./data/images/gimmie-32.png $startdir/pkg/usr/share/icons/hicolor/32x32/apps/ || return 1
  mkdir -p $startdir/pkg/usr/share/icons/hicolor/48x48/apps &&
  cp -vp ./data/images/gimmie.png $startdir/pkg/usr/share/icons/hicolor/48x48/apps/ || return 1
  mkdir -p $startdir/pkg/usr/share/icons/hicolor/scalable/apps &&
  cp -vp ./data/images/gimmie.svg $startdir/pkg/usr/share/icons/hicolor/scalable/apps/ || return 1
  # install Gimmie panel applet
  mkdir -p $startdir/pkg/usr/lib/$pkgname &&
  cp -vp ./gimmie/gimmie_applet $startdir/pkg/usr/lib/$pkgname/ || return 1
  # Python needs to know where Gimmie installed it's libraries
  mkdir -p $startdir/pkg/usr/lib/python2.6/site-packages &&
  ln -s /usr/lib/gimmie $startdir/pkg/usr/lib/python2.6/site-packages/gimmie || return 1

  find $startdir/pkg -name ".libs" -type d -exec rm -vr {} \;
  mkdir -vp $startdir/pkg/usr/bin && \
  echo "exec python /usr/lib/gimmie/gimmie.py" >$startdir/pkg/usr/bin/gimmie && \
  chmod 0755 $startdir/pkg/usr/bin/gimmie
}
