# $Id$
# Maintainer: Felix Yan <felixonmars@archlinux.org>
# Contributor: Josip Ponjavic <josipponjavic at gmail dot com>
# Contributor: Xu Fasheng <fasheng.xu[AT]gmail.com>

pkgname=deepin-go-dbus-factory
pkgver=0.0.5
pkgrel=1
pkgdesc='GO DBus factory for DDE'
arch=('any')
url="https://github.com/linuxdeepin/go-dbus-factory"
license=('GPL3')
depends=('deepin-go-lib')
makedepends=('go-pie' 'git')
source=("$pkgname-$pkgver.tar.gz::https://github.com/linuxdeepin/go-dbus-factory/archive/$pkgver.tar.gz")
sha512sums=('550771cf850c5ef34678b9f858674353853984f7cb6aca2d2d6f5208b979f29517cbe47340d5de57e088f63ef9ee739e501d4e1f84e7bd0bc3c8dcfe8df44325')

prepare() {
  export GOPATH="$srcdir/build:/usr/share/gocode"

  mkdir -p "$srcdir"/build/src/github.com/linuxdeepin
  ln -sf "$srcdir"/go-dbus-factory-$pkgver "$srcdir"/build/src/github.com/linuxdeepin/go-dbus-factory

  go get golang.org/x/net/context
}

build() {
  cd go-dbus-factory-$pkgver
  make bin
  ./gen.sh
}

package() {
  cd go-dbus-factory-$pkgver
  install -dm755 "$pkgdir"/usr/share/gocode/src/github.com/linuxdeepin/go-dbus-factory
  cp -a com.* org.* net.* object_manager "$pkgdir"/usr/share/gocode/src/github.com/linuxdeepin/go-dbus-factory/
}
