# Maintainer: Geoffroy Carrier <geoffroy.carrier@aur.archlinux.org>
# Contributor: Andrea Scarpino <bash.lnx@gmail.com>
# Contributor: Roman Kyrylych <roman@archlinux.org>

pkgname=virtualbox-ose-additions
pkgver=3.0.2
pkgrel=1
pkgdesc="Guest Additions for VirtualBox (Open Source Edition)"
url="http://www.virtualbox.org"
license=('GPL')
arch=('i686')
depends=('virtualbox-ose-additions-modules' 'gcc-libs' 'libxmu')
makedepends=('libstdc++5' 'bin86' 'dev86' 'iasl' 'libxslt' 'libxml2'
             'libidl2' 'mesa' 'libpng' 'curl' 'libcap')
source=(http://download.virtualbox.org/virtualbox/$pkgver/VirtualBox-$pkgver-OSE.tar.bz2)
build() {
  cd "$srcdir/VirtualBox-${pkgver}_OSE"
  sed -i 's/python2.5/python2.6/g' configure
  ./configure \
    --disable-xpcom \
    --disable-sdl-ttf \
    --disable-alsa \
    --disable-pulse \
    --disable-kmods \
    --build-headless
  source ./env.sh
  kmk additions-build-linux.x86 || return 1
  cd out/linux.$BUILD_PLATFORM_ARCH/release/bin/additions
  install -d "$pkgdir/usr/share/virtualbox/additions/"
  install -m755 VBoxClient VBoxControl VBoxService mountvboxsf \
  $pkgdir/usr/share/virtualbox/additions/ || return 1
  install -d "$pkgdir/usr/bin/"
  ln -sf /usr/share/virtualbox/additions/mountvboxsf \
  $pkgdir/usr/bin/mount.vboxfs || return 1
  install -D vboxmouse_drv_71.so \
    "$pkgdir/usr/lib/xorg/modules/input/vboxmouse.so" || return 1
  install -D vboxvideo_drv_71.so \
    "$pkgdir/usr/lib/xorg/modules/drivers/vboxvideo.so" || return 1
}

md5sums=('68e6658b8b11a509d7dec57835cba267')
