# $Id$
# Maintainer: Jaroslav Lichtblau <dragonlord@aur.archlinux.org>
# Contributor: Alexander Fehr <pizzapunk gmail com>
# Contributor: Mathias Nedreb√∏ <mathias <at> nedrebo.org>

pkgname=alunn
pkgver=0.7.16
pkgrel=3
pkgdesc="System tray notification applet for Arch Linux updates and news"
arch=('i686' 'x86_64')
_currentarch="$(uname -m)"
url="http://nedrebo.org/code/alunn"
license=('GPL')
depends=('dbus-python' 'gnome-python')
optdepends=('notification-daemon: Desktop notification support'
            'gksu: for default Gnome update command'
            'terminal: for default Gnome/XFCE update command'
            'kdesu: for default KDE update command'
            'konsole: for default KDE update command')
changelog=$pkgname.changelog
source=(http://nedrebo.org/page/code/$pkgname/.files/$pkgname-$pkgver.tar.gz)
md5sums=('b5b454fe61b7176c543874652abd27a0')

build() {
  cd ${srcdir}/$pkgname-$pkgver

  sed -i "s#replace('\$repo', repositories\[i\])#replace('\$repo', repositories\[i\]).replace('\$arch', '${_currentarch}')#" alunn/updatechecker.py

  # python2 fix
  for file in bin/alunn{,conf,_notify_buggy_tray_hack} alunn/{newsparser,updatechecker}.py; do
      sed -i 's_#!/usr/bin/env python_#!/usr/bin/env python2_' $file
  done

  sed -i 's/python2.6/python2.7/' install.sh

  ./install.sh --prefix=${pkgdir}
}
