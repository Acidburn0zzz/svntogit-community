# $Id$
# Maintainer:

pkgname=motion
pkgver=3.2.12
pkgrel=2
pkgdesc="A software motion detector which grabs images from video4linux devices and/or from webcams"
arch=('i686' 'x86_64')
license=('GPL')
url="http://www.lavrsen.dk/twiki/bin/view/Motion/WebHome"
depends=('ffmpeg' 'libjpeg' 'v4l-utils')
backup=('etc/motion/motion.conf')
options=('!makeflags')
source=(http://downloads.sourceforge.net/${pkgname}/${pkgname}-${pkgver}.tar.gz rc.motion ffmpeg-0.8.patch linux-headers.patch)
md5sums=('1ba0065ed50509aaffb171594c689f46' '24b6fbfa586857b72f90cda81410c14f')
sha1sums=('dc59b36e45e7626baa65ce62c961af918fea76bd' '06f74131a9d4abc8aa05f531bd19c51a5732023f')

build() {
  cd "${srcdir}/${pkgname}-${pkgver}"
  patch -Np1 -i $srcdir/ffmpeg-0.8.patch
  patch -Np1 -i $srcdir/linux-headers.patch
  ./configure --prefix=/usr \
    --without-pgsql \
    --without-mysql \
    --sysconfdir=/etc/motion
  make
}

package(){
  cd "${srcdir}/${pkgname}-${pkgver}"
  make DESTDIR="${pkgdir}" install
  mv "${pkgdir}/etc/motion/motion-dist.conf" "${pkgdir}/etc/motion/motion.conf"

  install -Dm755 "${srcdir}/rc.motion" "${pkgdir}/etc/rc.d/motion"
}
md5sums=('1ba0065ed50509aaffb171594c689f46'
         '24b6fbfa586857b72f90cda81410c14f'
         '2f422c268337dce583b9dac344005e93')
sha1sums=('dc59b36e45e7626baa65ce62c961af918fea76bd'
          '06f74131a9d4abc8aa05f531bd19c51a5732023f'
          '7b41c8c273980c147694d82af7c9cb9e51302dd9')
md5sums=('1ba0065ed50509aaffb171594c689f46'
         '24b6fbfa586857b72f90cda81410c14f'
         '5db295d7c2e4c38f36e861a3c4dfdd8d')
sha1sums=('dc59b36e45e7626baa65ce62c961af918fea76bd'
          '06f74131a9d4abc8aa05f531bd19c51a5732023f'
          '2b12df6d9053d17f6ac1969e3510dd50c6fe6667')
md5sums=('1ba0065ed50509aaffb171594c689f46'
         '24b6fbfa586857b72f90cda81410c14f'
         'd36687710837d69fbce4608b1345fa34')
sha1sums=('dc59b36e45e7626baa65ce62c961af918fea76bd'
          '06f74131a9d4abc8aa05f531bd19c51a5732023f'
          '6912448db0711f85322505ee6f8052f8f98ae634')
md5sums=('1ba0065ed50509aaffb171594c689f46'
         '24b6fbfa586857b72f90cda81410c14f'
         'd36687710837d69fbce4608b1345fa34'
         'd8c3c4fdded5cfbd729710475559a21d')
sha1sums=('dc59b36e45e7626baa65ce62c961af918fea76bd'
          '06f74131a9d4abc8aa05f531bd19c51a5732023f'
          '6912448db0711f85322505ee6f8052f8f98ae634'
          '6f33dab895ae398cc5e7017cbf5dc5d728f3ca9e')
