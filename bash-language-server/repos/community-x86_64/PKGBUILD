# $Id$
# Maintainer: Felix Yan <felixonmars@archlinux.org>

pkgname=bash-language-server
pkgver=1.4.0
pkgrel=1
pkgdesc='Bash language server implementation based on Tree Sitter and its grammar for Bash'
arch=('x86_64')
url='https://github.com/mads-hartmann/bash-language-server'
license=('MIT')
depends=('nodejs' 'acorn')
makedepends=('npm' 'python2')
source=("https://registry.npmjs.org/$pkgname/-/$pkgname-$pkgver.tgz")
noextract=("$pkgname-$pkgver.tgz")
sha512sums=('4ad2e130b2eeccd957ab95abe8658bc901b653886fc24ad87b272dde3b4df0d645f122df04eb0c9b880a9c394b1b05adaae35b81bb104ae289c40d7e107f0349')

package() {
  PYTHON=python2 npm install -g --user root --prefix "$pkgdir"/usr "$srcdir"/$pkgname-$pkgver.tgz

  # Fix permissions
  find "$pkgdir/usr" -type d -exec chmod 755 '{}' +

  cd "$pkgdir"/usr/lib/node_modules/$pkgname/node_modules
  for dep in acorn; do
    rm -r $dep;
  done

}
